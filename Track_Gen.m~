close all
clear all
clc

Direction = 1;
Interpolation = 10;
Length = 1200;

%% Read Data
csv_data = csvread('/Users/Foster/Documents/GitHub/IRG-EVX/FSUK Track Centreline.csv');

x = csv_data(:,1);
y = csv_data(:,2);

%% Adjust Start Finish
dist = (x.^2 + y.^2).^0.5;
[dist_min,start] = min(dist);

x = circshift(x,length(x) - start + 1);
y = circshift(y,length(y) - start + 1);
x = x - x(1);
y = y - y(1);

%% Interpolation
npoint_old = linspace(0,1,length(x))';
npoint_new = linspace(0,1,Interpolation * length(x))';

method = 'spline'; 
x = (interp1( npoint_old, x, npoint_new, method));
y = (interp1( npoint_old, y, npoint_new, method));

%% Change Direction

if Direction == -1
    x = fliplr(x);
    y = fliplr(y);
end

%% Path Length Adjust
Spacing = ((diff(x)).^2 + (diff(y)).^2).^0.5;    	%Magnitude distance between successive coordinates
Distance = cumsum(Spacing);                       	%Cumulative segment/path length

if Length > 0
    Ratio = Length/max(Distance);
    x = Ratio .* x;
    y = Ratio .* y;
    Distance = Ratio .* Distance;
end

%% Yaw Angle
theta = atan2(diff(y),diff(x));

% Address Discontinuities
for k = 2:1:length(theta)
    dChange = theta(k) - theta(k-1);
    if (abs(dChange) > 0.9*pi)
        r = round(dChange/pi);
        theta(k) = theta(k) - r*pi;
    end
end

%% 

%% Plot
hold on
plot(x,y,'k');
scatter(x(1),y(1),'x','r');
title('Track Map')
xlabel('x Direction (m)')
ylabel('y Direction (m)')

figure
plot(Distance,theta);
title('Yaw Angle')
xlabel('Distance (m)')
ylabel('Yaw Angle (rad)')