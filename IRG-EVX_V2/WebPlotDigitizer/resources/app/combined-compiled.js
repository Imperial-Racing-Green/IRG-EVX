var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),e=new a([[b,2],[c,3]]);if(2!=e.get(b)||3!=e.get(c))return!1;e.delete(b);e.set(c,4);return!e.has(b)&&4==e.get(c)}catch(m){return!1}}function c(){}function d(a){if(!$jscomp.owns(a,f)){var b=new c;$jscomp.defineProperty(a,f,{value:b})}}function e(a){var b=Object[a];b&&(Object[a]=function(a){if(a instanceof c)return a;d(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&
$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var f="$jscomp_hidden_"+Math.random();e("freeze");e("preventExtensions");e("seal");var g=0,h=function(a){this.id_=(g+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};h.prototype.set=function(a,b){d(a);if(!$jscomp.owns(a,f))throw Error("WeakMap key fail: "+a);a[f][this.id_]=b;return this};h.prototype.get=function(a){return $jscomp.owns(a,f)?a[f][this.id_]:void 0};h.prototype.has=
function(a){return $jscomp.owns(a,f)&&$jscomp.owns(a[f],this.id_)};h.prototype.delete=function(a){return $jscomp.owns(a,f)&&$jscomp.owns(a[f],this.id_)?delete a[f][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var e=c.entries(),d=e.next();if(d.done||d.value[0]!=b||"s"!=d.value[1])return!1;d=e.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!e.next().done?!1:!0}catch(p){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=new WeakMap,d=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(a,b){a=0===a?0:a;var c=e(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};d.prototype.delete=function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(a){return!!e(this,a).entry};
d.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};d.prototype.entries=function(){return f(this,function(a){return[a.key,a.value]})};d.prototype.keys=function(){return f(this,function(a){return a.key})};d.prototype.values=function(){return f(this,function(a){return a.value})};d.prototype.forEach=function(a,b){for(var c=this.entries(),e;!(e=c.next()).done;)e=e.value,a.call(b,e[1],e[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(a,b){var e=b&&typeof b;"object"==
e||"function"==e?c.has(b)?e=c.get(b):(e=""+ ++h,c.set(b,e)):e="p_"+b;var d=a.data_[e];if(d&&$jscomp.owns(a.data_,e))for(a=0;a<d.length;a++){var f=d[a];if(b!==b&&f.key!==f.key||b===f.key)return{id:e,list:d,index:a,entry:f}}return{id:e,list:d,index:-1,entry:void 0}},f=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=
a.next=a.head=a},h=0;return d},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([b]));if(!c.has(b)||1!=c.size||c.add(b)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var f=c.entries(),g=f.next();if(g.done||g.value[0]!=b||g.value[1]!=b)return!1;g=f.next();return g.done||g.value[0]==b||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:f.next().done}catch(h){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};c.prototype.add=function(a){a=0===a?0:a;this.map_.set(a,a);this.size=this.map_.size;return this};c.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};c.prototype.clear=function(){this.map_.clear();
this.size=0};c.prototype.has=function(a){return this.map_.has(a)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(e){return a.call(b,e,e,c)})};return c},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,d){c=null!=c?c:function(a){return a};var b=[],f="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof f){a=f.call(a);for(var g=0;!(f=a.next()).done;)b.push(c.call(d,f.value,g++))}else for(f=a.length,g=0;g<f;g++)b.push(c.call(d,a[g],g));return b}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");
$jscomp.polyfill("Math.log10",function(a){return a?a:function(a){return Math.log(a)/Math.LN10}},"es6","es3");$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,f=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var g=0;g<f&&c<e;)if(b[c++]!=a[g++])return!1;return g>=f}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6","es3");$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(e){c||(c=!0,a.call(b,e))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)f.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(r){f(r)}}:b}var d,f,g=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,e){for(var d=$jscomp.makeIterator(a),f=d.next();!f.done;f=d.next())c(f.value).callWhenSettled_(b,
e)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");var wpd=wpd||{};
wpd.initApp=function(){wpd.browserInfo.checkBrowser();wpd.layoutManager.initialLayout();wpd.imageManager.loadFromURL("start.png");wpd.log();document.getElementById("loadingCurtain").style.display="none"};document.addEventListener("DOMContentLoaded",wpd.initApp,!0);wpd=wpd||{};wpd._AutoDetectionDataCounter=0;
wpd.AutoDetectionData=function(){this.imageHeight=this.imageWidth=0;this.fgColor=[0,0,255];this.bgColor=[255,255,255];this.mask=new Set;this.binaryData=new Set;this.colorDetectionMode="fg";this.colorDistance=120;this.algorithm=null;this.name=wpd._AutoDetectionDataCounter++};
wpd.AutoDetectionData.prototype.serialize=function(){if(null==this.algorithm)return null;var a=this.algorithm.serialize();if(null==a)return null;var b=wpd.rle.encode(Array.from(this.mask.values()).sort(function(a,b){return a-b}));return{fgColor:this.fgColor,bgColor:this.bgColor,mask:b,colorDetectionMode:this.colorDetectionMode,colorDistance:this.colorDistance,algorithm:a,name:this.name,imageWidth:this.imageWidth,imageHeight:this.imageHeight}};
wpd.AutoDetectionData.prototype.deserialize=function(a){this.fgColor=a.fgColor;this.bgColor=a.bgColor;this.imageWidth=a.imageWidth;this.imageHeight=a.imageHeight;if(null!=a.mask){var b=wpd.rle.decode(a.mask);this.mask=new Set;b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next())this.mask.add(c.value)}this.colorDetectionMode=a.colorDetectionMode;this.colorDistance=a.colorDistance;null!=a.algorithm&&(b=a.algorithm.algoType,"AveragingWindowAlgo"===b?this.algorithm=new wpd.AveragingWindowAlgo:
"AveragingWindowWithStepSizeAlgo"===b?this.algorithm=new wpd.AveragingWindowWithStepSizeAlgo:"BarExtractionAlgo"===b?this.algorithm=new wpd.BarExtractionAlgo:"BlobDetectorAlgo"===b?this.algorithm=new wpd.BlobDetectorAlgo:"XStepWithInterpolationAlgo"===b&&(this.algorithm=new wpd.XStepWithInterpolationAlgo),this.algorithm.deserialize(a.algorithm));this.name=a.name};
wpd.AutoDetectionData.prototype.generateBinaryDataFromMask=function(a){this.binaryData=new Set;for(var b="fg"===this.colorDetectionMode?this.fgColor:this.bgColor,c=$jscomp.makeIterator(this.mask),d=c.next();!d.done;d=c.next()){d=d.value;var e=a.data[4*d],f=a.data[4*d+1],g=a.data[4*d+2];0===a.data[4*d+3]&&(g=f=e=255);e=wpd.dist3d(e,f,g,b[0],b[1],b[2]);"fg"===this.colorDetectionMode?e<=this.colorDistance&&this.binaryData.add(d):e>=this.colorDistance&&this.binaryData.add(d)}};
wpd.AutoDetectionData.prototype.generateBinaryDataUsingFullImage=function(a){this.binaryData=new Set;for(var b="fg"===this.colorDetectionMode?this.fgColor:this.bgColor,c=0;c<a.data.length;c++){var d=a.data[4*c],e=a.data[4*c+1],f=a.data[4*c+2];0===a.data[4*c+3]&&(f=e=d=255);d=wpd.dist3d(d,e,f,b[0],b[1],b[2]);"fg"===this.colorDetectionMode?d<=this.colorDistance&&this.binaryData.add(c):d>=this.colorDistance&&this.binaryData.add(c)}};
wpd.AutoDetectionData.prototype.generateBinaryData=function(a){null==this.mask||0==this.mask.size?this.generateBinaryDataUsingFullImage(a):this.generateBinaryDataFromMask(a)};
wpd.GridDetectionData=function(){this.mask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]};this.lineColor=[255,255,255];this.colorDistance=10;this.gridData=null;this.gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:new Set};this.binaryData=new Set;this.imageHeight=this.imageWidth=0;this.backupImageData=null;this.gridBackgroundMode=!0};
wpd.GridDetectionData.prototype.generateBinaryData=function(a){this.binaryData=new Set;this.imageWidth=a.width;this.imageHeight=a.height;if(null==this.gridMask.pixels||0===this.gridMask.pixels.size){this.gridMask.pixels=new Set;for(var b=0;b<this.imageHeight;b++)for(var c=0;c<this.imageWidth;c++){var d=b*this.imageWidth+c,e=a.data[4*d],f=a.data[4*d+1],g=a.data[4*d+2];0===a.data[4*d+3]&&(g=f=e=255);e=wpd.dist3d(this.lineColor[0],this.lineColor[1],this.lineColor[2],e,f,g);this.gridBackgroundMode?e>
this.colorDistance&&(this.binaryData.add(d),this.gridMask.pixels.add(d)):e<this.colorDistance&&(this.binaryData.add(d),this.gridMask.pixels.add(d))}this.gridMask.xmin=0;this.gridMask.xmax=this.imageWidth;this.gridMask.ymin=0;this.gridMask.ymax=this.imageHeight}else for(b=$jscomp.makeIterator(this.gridMask.pixels),c=b.next();!c.done;c=b.next())c=c.value,d=wpd.dist3d(this.lineColor[0],this.lineColor[1],this.lineColor[2],a.data[4*c],a.data[4*c+1],a.data[4*c+2]),this.gridBackgroundMode?d>this.colorDistance&&
this.binaryData.add(c):d<this.colorDistance&&this.binaryData.add(c)};wpd=wpd||{};wpd.Calibration=function(a){this._dim=a;this._px=[];this._py=[];this._dimensions=null==a?2:a;this._dp=[];this._selections=[];this.labels=[];this.labelPositions=[];this.maxPointCount=0};wpd.Calibration.prototype.getCount=function(){return this._px.length};wpd.Calibration.prototype.getDimensions=function(){return this._dimensions};
wpd.Calibration.prototype.addPoint=function(a,b,c,d,e){var f=this._px.length,g=this._dp.length;this._px[f]=a;this._py[f]=b;this._dp[g]=c;this._dp[g+1]=d;3===this._dimensions&&(this._dp[g+2]=e)};wpd.Calibration.prototype.getPoint=function(a){return 0>a||a>=this._px.length?null:{px:this._px[a],py:this._py[a],dx:this._dp[this._dimensions*a],dy:this._dp[this._dimensions*a+1],dz:2===this._dimensions?null:this._dp[this._dimensions*a+2]}};
wpd.Calibration.prototype.changePointPx=function(a,b,c){0>a||a>=this._px.length||(this._px[a]=b,this._py[a]=c)};wpd.Calibration.prototype.setDataAt=function(a,b,c,d){0>a||a>=this._px.length||(this._dp[this._dimensions*a]=b,this._dp[this._dimensions*a+1]=c,3===this._dimensions&&(this._dp[this._dimensions*a+2]=d))};
wpd.Calibration.prototype.findNearestPoint=function(a,b,c){c=null==c?50:parseFloat(c);for(var d=0,e=-1,f=0;f<this._px.length;f++){var g=Math.sqrt((a-this._px[f])*(a-this._px[f])+(b-this._py[f])*(b-this._py[f]));if(0>e&&g<=c||0<=e&&g<d)e=f,d=g}return e};wpd.Calibration.prototype.selectPoint=function(a){0>this._selections.indexOf(a)&&this._selections.push(a)};wpd.Calibration.prototype.selectNearestPoint=function(a,b,c){a=this.findNearestPoint(a,b,c);0<=a&&this.selectPoint(a)};
wpd.Calibration.prototype.getSelectedPoints=function(){return this._selections};wpd.Calibration.prototype.unselectAll=function(){this._selections=[]};wpd.Calibration.prototype.isPointSelected=function(a){return 0<=this._selections.indexOf(a)};wpd.Calibration.prototype.dump=function(){console.log(this._px);console.log(this._py);console.log(this._dp)};wpd=wpd||{};
wpd.ColorGroup=function(){return function(a){var b=0,c={r:0,g:0,b:0};a=null==a?100:a;this.getPixelCount=function(){return b};this.getAverageColor=function(){return c};this.isColorInGroup=function(d,e,f){return 0===b?!0:(c.r-d)*(c.r-d)+(c.g-e)*(c.g-e)+(c.b-f)*(c.b-f)<=a*a};this.addPixel=function(a,e,f){c.r=(c.r*b+a)/(b+1);c.g=(c.g*b+e)/(b+1);c.b=(c.b*b+f)/(b+1);b+=1}}}();
wpd.colorAnalyzer=function(){return{getTopColors:function(a){var b=[],c,d=[];b[0]=new wpd.ColorGroup(120);for(c=0;c<a.data.length;c+=4){var e=a.data[c];var f=a.data[c+1];var g=a.data[c+2];var h=a.data[c+3];0===h&&(g=f=e=255);var k=!1;for(h=0;h<b.length;h++)if(b[h].isColorInGroup(e,f,g)){b[h].addPixel(e,f,g);k=!0;break}k||(b[b.length]=new wpd.ColorGroup(120),b[b.length-1].addPixel(e,f,g))}b.sort(function(a,b){return a.getPixelCount()>b.getPixelCount()?-1:a.getPixelCount()<b.getPixelCount()?1:0});for(h=
0;h<b.length;h++)c=b[h].getAverageColor(),d[h]={r:parseInt(c.r,10),g:parseInt(c.g,10),b:parseInt(c.b,10),pixels:b[h].getPixelCount(),percentage:100*b[h].getPixelCount()/(.25*a.data.length)};return d}}}();wpd=wpd||{};wpd.ConnectedPoints=function(a){this._connections=[];this._selectedPointIndex=this._selectedConnectionIndex=-1;this._connectivity=a};wpd.ConnectedPoints.prototype.addConnection=function(a){this._connections.push(a)};wpd.ConnectedPoints.prototype.clearAll=function(){this._connections=[]};
wpd.ConnectedPoints.prototype.getConnectionAt=function(a){if(a<this._connections.length)return this._connections[a]};wpd.ConnectedPoints.prototype.replaceConnectionAt=function(a,b){a<this._connections.length&&(this._connections[a]=b)};wpd.ConnectedPoints.prototype.deleteConnectionAt=function(a){a<this._connections.length&&this._connections.splice(a,1)};wpd.ConnectedPoints.prototype.connectionCount=function(){return this._connections.length};
wpd.ConnectedPoints.prototype.findNearestPointAndConnection=function(a,b){var c=-1,d=-1,e,f;for(e=0;e<this._connections.length;e++)for(f=0;f<this._connections[e].length;f+=2){var g=(this._connections[e][f]-a)*(this._connections[e][f]-a)+(this._connections[e][f+1]-b)*(this._connections[e][f+1]-b);if(-1===d||g<h){c=e;d=f/2;var h=g}}return{connectionIndex:c,pointIndex:d}};
wpd.ConnectedPoints.prototype.selectNearestPoint=function(a,b){a=this.findNearestPointAndConnection(a,b);0<=a.connectionIndex&&(this._selectedConnectionIndex=a.connectionIndex,this._selectedPointIndex=a.pointIndex)};wpd.ConnectedPoints.prototype.deleteNearestConnection=function(a,b){a=this.findNearestPointAndConnection(a,b);0<=a.connectionIndex&&this.deleteConnectionAt(a.connectionIndex)};
wpd.ConnectedPoints.prototype.isPointSelected=function(a,b){return this._selectedPointIndex===b&&this._selectedConnectionIndex===a?!0:!1};wpd.ConnectedPoints.prototype.getSelectedConnectionAndPoint=function(){return{connectionIndex:this._selectedConnectionIndex,pointIndex:this._selectedPointIndex}};wpd.ConnectedPoints.prototype.unselectConnectionAndPoint=function(){this._selectedPointIndex=this._selectedConnectionIndex=-1};
wpd.ConnectedPoints.prototype.setPointAt=function(a,b,c,d){this._connections[a][2*b]=c;this._connections[a][2*b+1]=d};wpd.ConnectedPoints.prototype.getPointAt=function(a,b){return{x:this._connections[a][2*b],y:this._connections[a][2*b+1]}};wpd.DistanceMeasurement=function(){wpd.ConnectedPoints.call(this,2)};$jscomp.inherits(wpd.DistanceMeasurement,wpd.ConnectedPoints);
wpd.DistanceMeasurement.prototype.getDistance=function(a){if(a<this._connections.length&&2===this._connectivity)return Math.sqrt((this._connections[a][0]-this._connections[a][2])*(this._connections[a][0]-this._connections[a][2])+(this._connections[a][1]-this._connections[a][3])*(this._connections[a][1]-this._connections[a][3]))};wpd.AngleMeasurement=function(){wpd.ConnectedPoints.call(this,3)};$jscomp.inherits(wpd.AngleMeasurement,wpd.ConnectedPoints);
wpd.AngleMeasurement.prototype.getAngle=function(a){if(a<this._connections.length&&3===this._connectivity){var b=wpd.taninverse(-(this._connections[a][5]-this._connections[a][3]),this._connections[a][4]-this._connections[a][2]);a=wpd.taninverse(-(this._connections[a][1]-this._connections[a][3]),this._connections[a][0]-this._connections[a][2]);b=180*(b-a)/Math.PI;return 0>b?b+360:b}};wpd.AreaMeasurement=function(){wpd.ConnectedPoints.call(this,-1)};$jscomp.inherits(wpd.AreaMeasurement,wpd.ConnectedPoints);
wpd.AreaMeasurement.prototype.getArea=function(a){if(a<this._connections.length&&4<=this._connections[a].length){for(var b=0,c=0;c<this._connections[a].length;c+=2){var d=this._connections[a][c],e=this._connections[a][c+1];if(c<=this._connections[a].length-4){var f=this._connections[a][c+2];var g=this._connections[a][c+3]}else f=this._connections[a][0],g=this._connections[a][1];b+=d*g-f*e}return b/2}return 0};
wpd.AreaMeasurement.prototype.getPerimeter=function(a){if(a<this._connections.length){for(var b=0,c=0,d=0,e=0;e<this._connections[a].length;e+=2){var f=this._connections[a][e],g=this._connections[a][e+1];2<=e&&(b+=Math.sqrt((f-c)*(f-c)+(g-d)*(g-d)));e==this._connections[a].length-2&&4<=e&&(c=this._connections[a][0],d=this._connections[a][1],b+=Math.sqrt((f-c)*(f-c)+(g-d)*(g-d)));c=f;d=g}return b}};wpd=wpd||{};
wpd.plotDataProvider=function(){var a=null;return{setDataSource:function(b){a=b},getData:function(){var b=wpd.appData.getPlotData().getAxesForDataset(a);if(b instanceof wpd.BarAxes){var c=a,d=[],e;for(e=0;e<c.getCount();e++){var f=c.getPixel(e);var g=b.pixelToData(f.x,f.y);d[e]=[];f=null==f.metadata?"Bar"+e:f.metadata[0];d[e][0]=f;d[e][1]=g[0]}return{fields:["Label","Value"],fieldDateFormat:[],rawData:d,allowConnectivity:!1,connectivityFieldIndices:[],isFieldSortable:[!1,!0]}}var h=a;c=[];d=[];e=
[];g=[];var k,l;f=h.hasMetadata();var n=h.getMetadataKeys(),m=!0===f?n.length:0;for(k=0;k<h.getCount();k++){var p=h.getPixel(k);var q=b.pixelToData(p.x,p.y);e[k]=[];for(l=0;l<q.length;l++)e[k][l]=q[l];for(l=0;l<m;l++){var t=null==p.metadata||null==p.metadata[l]?0:p.metadata[l];e[k][q.length+l]=t}}h=b.getAxesLabels();f&&(h=h.concat(n));for(l=0;l<h.length;l++)l<b.getDimensions()&&(d[l]=l,null!=b.isDate&&b.isDate(l)&&(c[l]=b.getInitialDateFormat(l))),g[l]=!0;return{fields:h,fieldDateFormat:c,rawData:e,
allowConnectivity:!0,connectivityFieldIndices:d,isFieldSortable:g}}}}();
wpd.measurementDataProvider=function(){var a=null;return{getData:function(){var b=[],c=[],d=[],e=wpd.appData.getPlotData().getAxesForMeasurement(a),f=null!=e&&e instanceof wpd.MapAxes;if(a instanceof wpd.DistanceMeasurement){for(b=0;b<a.connectionCount();b++)c[b]=[],c[b][0]="Dist"+b,c[b][1]=f?e.pixelToDataDistance(a.getDistance(b)):a.getDistance(b);b=["Label","Distance"];d=[!1,!0]}else if(a instanceof wpd.AngleMeasurement){for(b=0;b<a.connectionCount();b++)c[b]=[],c[b][0]="Theta"+b,c[b][1]=a.getAngle(b);
b=["Label","Angle"];d=[!1,!0]}else if(a instanceof wpd.AreaMeasurement){for(b=0;b<a.connectionCount();b++)c[b]=[],c[b][0]="Poly"+b,f?(c[b][1]=e.pixelToDataArea(a.getArea(b)),c[b][2]=e.pixelToDataDistance(a.getPerimeter(b))):(c[b][1]=a.getArea(b),c[b][2]=a.getPerimeter(b));b=["Label","Area","Perimeter"];d=[!1,!0,!0]}return{fields:b,fieldDateFormat:[],rawData:c,allowConnectivity:!1,connectivityFieldIndices:[],isFieldSortable:d}},setDataSource:function(b){a=b}}}();wpd=wpd||{};
wpd.Dataset=function(a){this._dim=a;this._dataPoints=[];this._connections=[];this._selections=[];this._hasMetadata=!1;this._mkeys=[];this.name="Defaut Dataset";this.variableNames=["x","y"]};wpd.Dataset.prototype.hasMetadata=function(){return this._hasMetadata};wpd.Dataset.prototype.setMetadataKeys=function(a){this._mkeys=a};wpd.Dataset.prototype.getMetadataKeys=function(){return this._mkeys};
wpd.Dataset.prototype.addPixel=function(a,b,c){this._dataPoints[this._dataPoints.length]={x:a,y:b,metadata:c};null!=c&&(this._hasMetadata=!0)};wpd.Dataset.prototype.getPixel=function(a){return this._dataPoints[a]};wpd.Dataset.prototype.setPixelAt=function(a,b,c){a<this._dataPoints.length&&(this._dataPoints[a].x=b,this._dataPoints[a].y=c)};wpd.Dataset.prototype.setMetadataAt=function(a,b){a<this._dataPoints.length&&(this._dataPoints[a].metadata=b)};
wpd.Dataset.prototype.insertPixel=function(a,b,c,d){this._dataPoints.splice(a,0,{x:b,y:c,metadata:d})};wpd.Dataset.prototype.removePixelAtIndex=function(a){a<this._dataPoints.length&&this._dataPoints.splice(a,1)};wpd.Dataset.prototype.removeLastPixel=function(){removePixelAtIndex(this._dataPoints.length-1)};
wpd.Dataset.prototype.findNearestPixel=function(a,b,c){c=null==c?50:parseFloat(c);for(var d=0,e=-1,f=0;f<this._dataPoints.length;f++){var g=Math.sqrt((a-this._dataPoints[f].x)*(a-this._dataPoints[f].x)+(b-this._dataPoints[f].y)*(b-this._dataPoints[f].y));if(0>e&&g<=c||0<=e&&g<d)e=f,d=g}return e};wpd.Dataset.prototype.removeNearestPixel=function(a,b,c){a=this.findNearestPixel(a,b,c);0<=a&&this.removePixelAtIndex(a)};
wpd.Dataset.prototype.clearAll=function(){this._dataPoints=[];this._hasMetadata=!1;this._mkeys=[]};wpd.Dataset.prototype.getCount=function(){return this._dataPoints.length};wpd.Dataset.prototype.selectPixel=function(a){0<=this._selections.indexOf(a)||this._selections.push(a)};wpd.Dataset.prototype.unselectAll=function(){this._selections=[]};wpd.Dataset.prototype.selectNearestPixel=function(a,b,c){a=this.findNearestPixel(a,b,c);0<=a&&this.selectPixel(a);return a};
wpd.Dataset.prototype.selectNextPixel=function(){for(var a=0;a<this._selections.length;a++)this._selections[a]=(this._selections[a]+1)%this._dataPoints.length};wpd.Dataset.prototype.selectPreviousPixel=function(){for(var a=0;a<this._selections.length;a++){var b=this._selections[a];b=0===b?this._dataPoints.length-1:b-1;this._selections[a]=b}};wpd.Dataset.prototype.getSelectedPixels=function(){return this._selections};wpd=wpd||{};
wpd.dateConverter=function(){function a(a){a=a.toString();var b=a.split(/[/ :]/);a=0<=a.indexOf("/");if(0>=b.length||6<b.length)return null;if(a){a=parseInt(b[0],10);var d=parseInt(void 0===b[1]?0:b[1],10);var e=parseInt(void 0===b[2]?1:b[2],10);var f=3}else e=new Date,a=e.getFullYear(),d=e.getMonth()+1,e=e.getDate(),f=0;var g=parseInt(void 0===b[f]?0:b[f],10);var h=parseInt(void 0===b[f+1]?0:b[f+1],10);b=parseInt(void 0===b[f+2]?0:b[f+2],10);if(isNaN(a)||isNaN(d)||isNaN(e)||isNaN(g)||isNaN(h)||isNaN(b)||
12<d||1>d||31<e||1>e||23<g||0>g||59<h||0>h||59<b||0>b)return null;f=new Date;f.setUTCFullYear(a);f.setUTCMonth(d-1);f.setUTCDate(e);f.setUTCHours(g,h,b);b=parseFloat(Date.parse(f));return isNaN(b)?null:b}return{parse:function(b){return null==b||"string"===typeof b&&0>b.indexOf("/")&&0>b.indexOf(":")?null:a(b)},getFormatString:function(a){var b=a.split(/[/ :]/);a=0<=a.indexOf("/");var d="yyyy/mm/dd hh:ii:ss";1<=b.length&&(d=a?"yyyy":"hh");2<=b.length&&(d+=a?"/mm":":ii");3<=b.length&&(d+=a?"/dd":":ss");
4<=b.length&&(d+=" hh");5<=b.length&&(d+=":ii");6===b.length&&(d+=":ss");return d},formatDateNumber:function(a,c){var b=1;0<=c.indexOf("s")?b=1E3:0<=c.indexOf("i")?b=6E4:0<=c.indexOf("h")?b=36E5:0<=c.indexOf("d")?b=864E5:0<=c.indexOf("m")?b=2629746E3:0<=c.indexOf("y")&&(b=31556952E3);a=new Date(Math.round((new Date(a)).getTime()/b)*b);b=[];for(var e=[],f=new Date,g=0;12>g;g++)f.setUTCMonth(g),b.push(f.toLocaleString(void 0,{month:"long"})),e.push(f.toLocaleString(void 0,{month:"short"}));c=c.replace("YYYY",
"yyyy");c=c.replace("YY","yy");c=c.replace("MMMM","mmmm");c=c.replace("MMM","mmm");c=c.replace("MM","mm");c=c.replace("DD","dd");c=c.replace("HH","hh");c=c.replace("II","ii");c=c.replace("SS","ss");c=c.replace("yyyy",a.getUTCFullYear());f=a.getUTCFullYear()%100;c=c.replace("yy",10>f?"0"+f:f);c=c.replace("mmmm",b[a.getUTCMonth()]);c=c.replace("mmm",e[a.getUTCMonth()]);c=c.replace("mm",("0"+(a.getUTCMonth()+1)).slice(-2));c=c.replace("dd",("0"+a.getUTCDate()).slice(-2));c=c.replace("hh",("0"+a.getUTCHours()).slice(-2));
c=c.replace("ii",("0"+a.getUTCMinutes()).slice(-2));return c=c.replace("ss",("0"+a.getUTCSeconds()).slice(-2))}}}();wpd=wpd||{};
wpd.gridDetectionCore=function(){var a,b,c=.1,d=.1;return{run:function(e){var f=new Set,g,h,k=e.gridMask.xmin,l=e.gridMask.xmax,n=e.gridMask.ymin,m=e.gridMask.ymax,p=e.imageWidth;if(b)for(g=k;g<=l;g++){var q=0;for(h=n;h<m;h++)e.binaryData.has(h*p+g)&&q++;if(q>d*(m-n))for(h=n;h<m;h++)f.add(h*p+g)}if(a)for(h=n;h<=m;h++){q=0;for(g=k;g<=l;g++)e.binaryData.has(h*p+g)&&q++;if(q>c*(l-k))for(g=k;g<=l;g++)f.add(h*p+g)}return f},setHorizontalParameters:function(b,c){a=b;d=Math.abs(parseFloat(c)/100)},setVerticalParameters:function(a,
d){b=a;c=Math.abs(parseFloat(d)/100)}}}();wpd=wpd||{};wpd.InputParser=function(){this.isDate=this.isValid=!1;this.formatting=null};wpd.InputParser.prototype.parse=function(a){this.isDate=this.isValid=!1;this.formatting=null;if(null==a||"string"===typeof a&&(a=a.trim(),0<=a.indexOf("^")))return null;var b=wpd.dateConverter.parse(a);if(null!=b)return this.isDate=this.isValid=!0,this.formatting=wpd.dateConverter.getFormatString(a),b;a=parseFloat(a);return isNaN(a)?null:(this.isValid=!0,a)};
wpd=wpd||{};wpd.taninverse=function(a,b){var c;0<a?c=Math.atan2(a,b):0>=a&&(c=Math.atan2(a,b)+2*Math.PI);c>=2*Math.PI&&(c=0);return c};wpd.sqDist2d=function(a,b,c,d){return(a-c)*(a-c)+(b-d)*(b-d)};wpd.sqDist3d=function(a,b,c,d,e,f){return(a-d)*(a-d)+(b-e)*(b-e)+(c-f)*(c-f)};wpd.dist2d=function(a,b,c,d){return Math.sqrt(wpd.sqDist2d(a,b,c,d))};wpd.dist3d=function(a,b,c,d,e,f){return Math.sqrt(wpd.sqDist3d(a,b,c,d,e,f))};
wpd.mat=function(){function a(a){return a[0]*a[3]-a[1]*a[2]}return{det2x2:a,inv2x2:function(b){var c=a(b);return[b[3]/c,-b[1]/c,-b[2]/c,b[0]/c]},mult2x2:function(a,c){return[a[0]*c[0]+a[1]*c[2],a[0]*c[1]+a[1]*c[3],a[2]*c[0]+a[3]*c[2],a[2]*c[1]+a[3]*c[3]]},mult2x2Vec:function(a,c){return[a[0]*c[0]+a[1]*c[1],a[2]*c[0]+a[3]*c[1]]},multVec2x2:function(a,c){return[c[0]*a[0]+c[2]*a[1],c[1]*a[0]+c[3]*a[1]]}}}();
wpd.cspline=function(a,b){var c=a.length;a={x:a,y:b,len:c,d:[]};var d=[],e=[],f;if(3>c)return null;e[0]=2;d[0]=3*(b[1]-b[0]);for(f=1;f<c-1;++f)e[f]=4-1/e[f-1],d[f]=3*(b[f+1]-b[f-1])-d[f-1]/e[f-1];e[c-1]=2-1/e[c-2];d[c-1]=3*(b[c-1]-b[c-2])-d[c-2]/e[c-1];f=c-1;for(a.d[f]=d[f]/e[f];0<f;)--f,a.d[f]=(d[f]-a.d[f+1])/e[f];return a};
wpd.cspline_interp=function(a,b){var c=0;if(b>=a.x[a.len-1]||b<a.x[0])return null;for(;b>a.x[c];)c++;c=0<c?c-1:0;b=(b-a.x[c])/(a.x[c+1]-a.x[c]);return a.y[c]+a.d[c]*b+(3*(a.y[c+1]-a.y[c])-2*a.d[c]-a.d[c+1])*b*b+(2*(a.y[c]-a.y[c+1])+a.d[c]+a.d[c+1])*b*b*b};
wpd.calculateHomographyMatrix=function(a,b){a=wpd.wasmHelper.arrayToPtr(originalCorners);b=wpd.wasmHelper.arrayToPtr(b);var c=Module._newDoubleArray(9);Module._computeHomography(a,b,c);var d=wpd.wasmHelper.ptrToArray(c);wpd.wasmHelper.freePtr(a);wpd.wasmHelper.freePtr(b);wpd.wasmHelper.freePtr(c);return d};wpd=wpd||{};
wpd.PlotData=function(){this._topColors=null;this._axesColl=[];this._datasetColl=[];this._measurementColl=[];this._objectAxesMap=new Map;this._datasetAutoDetectionDataMap=new Map;this._gridDetectionData=null};wpd.PlotData.prototype.reset=function(){this._axesColl=[];this._datasetColl=[];this._measurementColl=[];this._objectAxesMap=new Map;this._datasetAutoDetectionDataMap=new Map;this._gridDetectionData=null};wpd.PlotData.prototype.setTopColors=function(a){this._topColors=a};
wpd.PlotData.prototype.getTopColors=function(a){return this._topColors};wpd.PlotData.prototype.addAxes=function(a){this._axesColl.push(a);1===this._axesColl.length&&0===this._datasetColl.length&&(a=new wpd.Dataset,a.name="Default Dataset",this.addDataset(a))};wpd.PlotData.prototype.getAxesColl=function(){return this._axesColl};wpd.PlotData.prototype.getAxesNames=function(){var a=[];this._axesColl.forEach(function(b){a.push(b.name)});return a};
wpd.PlotData.prototype.deleteAxes=function(a){var b=this._axesColl.indexOf(a);0<=b&&(this._axesColl.splice(b,1),this._objectAxesMap.forEach(function(b,d,e){b===a&&e.set(d,null)}))};wpd.PlotData.prototype.getAxesCount=function(){return this._axesColl.length};wpd.PlotData.prototype.addDataset=function(a){this._datasetColl.push(a);var b=this._axesColl.length;0<b&&this.setAxesForDataset(a,this._axesColl[b-1])};wpd.PlotData.prototype.getDatasets=function(){return this._datasetColl};
wpd.PlotData.prototype.getDatasetNames=function(){var a=[];this._datasetColl.forEach(function(b){a.push(b.name)});return a};wpd.PlotData.prototype.getDatasetCount=function(){return this._datasetColl.length};
wpd.PlotData.prototype.addMeasurement=function(a){this._measurementColl.push(a);if(a instanceof wpd.DistanceMeasurement&&0<this._axesColl.length)for(var b=0;b<this._axesColl.length;b++)if(this._axesColl[b]instanceof wpd.MapAxes||this._axesColl[b]instanceof wpd.ImageAxes){this.setAxesForMeasurement(a,this._axesColl[b]);break}};wpd.PlotData.prototype.getMeasurementsByType=function(a){var b=[];this._measurementColl.forEach(function(c){c instanceof a&&b.push(c)});return b};
wpd.PlotData.prototype.deleteMeasurement=function(a){var b=this._measurementColl.indexOf(a);0<=b&&(this._measurementColl.splice(b,1),this._objectAxesMap.delete(a))};wpd.PlotData.prototype.setAxesForDataset=function(a,b){this._objectAxesMap.set(a,b)};wpd.PlotData.prototype.setAxesForMeasurement=function(a,b){this._objectAxesMap.set(a,b)};wpd.PlotData.prototype.setAutoDetectionDataForDataset=function(a,b){this._datasetAutoDetectionDataMap.set(a,b)};wpd.PlotData.prototype.getAxesForDataset=function(a){return this._objectAxesMap.get(a)};
wpd.PlotData.prototype.getAxesForMeasurement=function(a){return this._objectAxesMap.get(a)};wpd.PlotData.prototype.getAutoDetectionDataForDataset=function(a){var b=this._datasetAutoDetectionDataMap.get(a);null==b&&(b=new wpd.AutoDetectionData,this.setAutoDetectionDataForDataset(a,b));return b};wpd.PlotData.prototype.getGridDetectionData=function(){null==this._gridDetectionData&&(this._gridDetectionData=new wpd.GridDetectionData);return this._gridDetectionData};
wpd.PlotData.prototype.deleteDataset=function(a){var b=this._datasetColl.indexOf(a);0<=b&&(this._datasetColl.splice(b,1),this._objectAxesMap.delete(a),this._datasetAutoDetectionDataMap.delete(a))};
wpd.PlotData.prototype._deserializePreVersion4=function(a){if(null==a.axesType)return!0;if("ImageAxes"!==a.axesType&&(null==a.calibration||null==a.axesParameters))return!1;var b=null;if("ImageAxes"!==a.axesType){b="TernaryAxes"===a.axesType?new wpd.Calibration(3):new wpd.Calibration(2);for(var c=0;c<a.calibration.length;c++)b.addPoint(a.calibration[c].px,a.calibration[c].py,a.calibration[c].dx,a.calibration[c].dy,a.calibration[c].dz)}c=null;"XYAxes"===a.axesType?(c=new wpd.XYAxes,b.labels=["X1","X2",
"Y1","Y2"],b.labelPositions=["N","N","E","E"],b.maxPointCount=4,c.calibrate(b,a.axesParameters.isLogX,a.axesParameters.isLogY)):"BarAxes"===a.axesType?(c=new wpd.BarAxes,b.labels=["P1","P2"],b.labelPositions=["S","S"],b.maxPointCount=2,c.calibrate(b,a.axesParameters.isLog)):"PolarAxes"===a.axesType?(c=new wpd.PolarAxes,b.labels=["Origin","P1","P2"],b.labelPositions=["E","S","S"],b.maxPointCount=3,c.calibrate(b,a.axesParameters.isDegrees,a.axesParameters.isClockwise)):"TernaryAxes"===a.axesType?(c=
new wpd.TernaryAxes,b.labels=["A","B","C"],b.labelPositions=["S","S","E"],b.maxPointCount=3,c.calibrate(b,a.axesParameters.isRange100,a.axesParameters.isNormalOrientation)):"MapAxes"===a.axesType?(c=new wpd.MapAxes,b.labels=["P1","P2"],b.labelPositions=["S","S"],b.maxPointCount=2,c.calibrate(b,a.axesParameters.scaleLength,a.axesParameters.unitString)):"ImageAxes"===a.axesType&&(c=new wpd.ImageAxes);null!=c&&this._axesColl.push(c);if(null!=a.dataSeries)for(b=0;b<a.dataSeries.length;b++){var d=a.dataSeries[b],
e=new wpd.Dataset;e.name=d.name;null!=d.metadataKeys&&e.setMetadataKeys(d.metadataKeys);for(var f=0;f<d.data.length;f++)e.addPixel(d.data[f].x,d.data[f].y,d.data[f].metadata);this.addDataset(e);this.setAxesForDataset(e,c)}if(null!=a.distanceMeasurementData){b=new wpd.DistanceMeasurement;for(d=0;d<a.distanceMeasurementData.length;d++)b.addConnection(a.distanceMeasurementData[d]);this.addMeasurement(b);c instanceof wpd.MapAxes&&this.setAxesForMeasurement(b,c)}if(null!=a.angleMeasurementData){c=new wpd.AngleMeasurement;
for(b=0;b<a.angleMeasurementData.length;b++)c.addConnection(a.angleMeasurementData[b]);this.addMeasurement(c)}return!0};
wpd.PlotData.prototype._deserializeVersion4=function(a){if(null!=a.axesColl)for(var b=0;b<a.axesColl.length;b++){var c=a.axesColl[b],d=null;if("ImageAxes"!==c.type){d="TernaryAxes"===c.type?new wpd.Calibration(3):new wpd.Calibration(2);for(var e=0;e<c.calibrationPoints.length;e++)d.addPoint(c.calibrationPoints[e].px,c.calibrationPoints[e].py,c.calibrationPoints[e].dx,c.calibrationPoints[e].dy,c.calibrationPoints[e].dz)}e=null;"XYAxes"===c.type?(e=new wpd.XYAxes,d.labels=["X1","X2","Y1","Y2"],d.labelPositions=
["N","N","E","E"],d.maxPointCount=4,e.calibrate(d,c.isLogX,c.isLogY)):"BarAxes"===c.type?(e=new wpd.BarAxes,d.labels=["P1","P2"],d.labelPositions=["S","S"],d.maxPointCount=2,e.calibrate(d,c.isLog,null==c.isRotated?!1:c.isRotated)):"PolarAxes"===c.type?(e=new wpd.PolarAxes,d.labels=["Origin","P1","P2"],d.labelPositions=["E","S","S"],d.maxPointCount=3,e.calibrate(d,c.isDegrees,c.isClockwise,c.isLog)):"TernaryAxes"===c.type?(e=new wpd.TernaryAxes,d.labels=["A","B","C"],d.labelPositions=["S","S","E"],
d.maxPointCount=3,e.calibrate(d,c.isRange100,c.isNormalOrientation)):"MapAxes"===c.type?(e=new wpd.MapAxes,d.labels=["P1","P2"],d.labelPositions=["S","S"],d.maxPointCount=2,e.calibrate(d,c.scaleLength,c.unitString)):"ImageAxes"===c.type&&(e=new wpd.ImageAxes);null!=e&&(e.name=c.name,this._axesColl.push(e))}if(null!=a.datasetColl)for(b=0;b<a.datasetColl.length;b++){c=a.datasetColl[b];d=new wpd.Dataset;d.name=c.name;null!=c.metadataKeys&&d.setMetadataKeys(c.metadataKeys);for(e=0;e<c.data.length;e++)d.addPixel(c.data[e].x,
c.data[e].y,c.data[e].metadata);this._datasetColl.push(d);e=this.getAxesNames().indexOf(c.axesName);0<=e&&this.setAxesForDataset(d,this._axesColl[e]);null!=c.autoDetectionData&&(e=new wpd.AutoDetectionData,e.deserialize(c.autoDetectionData),this.setAutoDetectionDataForDataset(d,e))}if(null!=a.measurementColl)for(b=0;b<a.measurementColl.length;b++)if(c=a.measurementColl[b],d=null,"Distance"===c.type?(d=new wpd.DistanceMeasurement,this._measurementColl.push(d),e=this.getAxesNames().indexOf(c.axesName),
0<=e&&this.setAxesForMeasurement(d,this._axesColl[e])):"Angle"===c.type?(d=new wpd.AngleMeasurement,this._measurementColl.push(d)):"Area"===c.type&&(d=new wpd.AreaMeasurement,this._measurementColl.push(d),e=this.getAxesNames().indexOf(c.axesName),0<=e&&this.setAxesForMeasurement(d,this._axesColl[e])),null!=d)for(e=0;e<c.data.length;e++)d.addConnection(c.data[e]);return!0};
wpd.PlotData.prototype.deserialize=function(a){this.reset();try{return null!=a.wpd&&3===a.wpd.version[0]?this._deserializePreVersion4(a.wpd):null!=a.version&&4===a.version[0]?this._deserializeVersion4(a):!0}catch(b){return console.log(b),!1}};
wpd.PlotData.prototype.serialize=function(){for(var a={version:[4,2],axesColl:[],datasetColl:[],measurementColl:[]},b=0;b<this._axesColl.length;b++){var c=this._axesColl[b],d={};d.name=c.name;c instanceof wpd.XYAxes?(d.type="XYAxes",d.isLogX=c.isLogX(),d.isLogY=c.isLogY()):c instanceof wpd.BarAxes?(d.type="BarAxes",d.isLog=c.isLog(),d.isRotated=c.isRotated()):c instanceof wpd.PolarAxes?(d.type="PolarAxes",d.isDegrees=c.isThetaDegrees(),d.isClockwise=c.isThetaClockwise(),d.isLog=c.isRadialLog()):c instanceof
wpd.TernaryAxes?(d.type="TernaryAxes",d.isRange100=c.isRange100(),d.isNormalOrientation=c.isNormalOrientation):c instanceof wpd.MapAxes?(d.type="MapAxes",d.scaleLength=c.getScaleLength(),d.unitString=c.getUnits()):c instanceof wpd.ImageAxes&&(d.type="ImageAxes");if(!(c instanceof wpd.ImageAxes)){d.calibrationPoints=[];for(var e=0;e<c.calibration.getCount();e++)d.calibrationPoints.push(c.calibration.getPoint(e))}a.axesColl.push(d)}for(b=0;b<this._datasetColl.length;b++){c=this._datasetColl[b];d=this.getAxesForDataset(c);
e=this.getAutoDetectionDataForDataset(c);var f={};f.name=c.name;f.axesName=null!=d?d.name:"";f.metadataKeys=c.getMetadataKeys();f.data=[];for(var g=0;g<c.getCount();g++){var h=c.getPixel(g);f.data[g]=h;null!=d&&(f.data[g].value=d.pixelToData(h.x,h.y))}f.autoDetectionData=null!=e?e.serialize():null;a.datasetColl.push(f)}for(b=0;b<this._measurementColl.length;b++){c=this._measurementColl[b];e=this.getAxesForMeasurement(c);d={};c instanceof wpd.DistanceMeasurement?(d.type="Distance",d.name="Distance",
d.axesName=null!=e?e.name:""):c instanceof wpd.AngleMeasurement?(d.type="Angle",d.name="Angle"):c instanceof wpd.AreaMeasurement&&(d.type="Area",d.name="Area",d.axesName=null!=e?e.name:"");d.data=[];for(e=0;e<c.connectionCount();e++)d.data.push(c.getConnectionAt(e));a.measurementColl.push(d)}return a};wpd=wpd||{};wpd.rle={};
wpd.rle.encode=function(a){var b=[],c=null,d=[0,0];a=$jscomp.makeIterator(a);for(var e=a.next();!e.done;e=a.next())e=e.value,null==c?d=[e,1]:e==c+1?d[1]++:(b.push(d),d=[e,1]),c=e;0!=d[1]&&b.push(d);return b};wpd.rle.decode=function(a){var b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var d=c.value;c=d[0];d=d[1];for(var e=0;e<d;++e)b.push(c+e)}return b};wpd=wpd||{};onWASMLoad=function(){};
wpd.wasmHelper={arrayToPtr:function(a){var b=Module._newDoubleArray(a.length);Module.HEAPF64.set(new Float64Array(a),b/Float64Array.BYTES_PER_ELEMENT);return b},ptrToArray:function(a,b){var c=new Float64Array(b);c.set(Module.HEAPF64.subarray(a/Float64Array.BYTES_PER_ELEMENT,a/Float64Array.BYTES_PER_ELEMENT+b));return c},freePtr:function(a){Module._freeArray(a)},printVersion:function(){Module._printVersion()}};wpd=wpd||{};
wpd.AveragingWindowCore=function(a,b,c,d,e,f){this._binaryData=a;this._imageHeight=b;this._imageWidth=c;this._dx=d;this._dy=e;this._dataSeries=f};
wpd.AveragingWindowCore.prototype.run=function(){var a=[],b=0,c=this._imageWidth,d=this._imageHeight,e=[],f,g,h,k,l=this._dx,n=this._dy;this._dataSeries.clearAll();for(f=0;f<c;f++){var m=-1;var p=-2*n;for(g=h=0;g<d;g++)this._binaryData.has(g*c+f)&&(g>p+n?(m+=1,h=1,p=e[m]=g):(h+=1,e[m]=parseFloat((e[m]*(h-1)+g)/parseFloat(h))));if(0<=m)for(p=f+.5,g=0;g<=m;g++)h=e[g]+.5,a[b]=[],a[b][0]=parseFloat(p),a[b][1]=parseFloat(h),a[b][2]=!0,b+=1}if(0!==b){for(c=0;c<b;c++)if(!0===a[c][2]){d=!0;e=c+1;f=a[c][0];
m=a[c][1];g=f;p=m;for(k=1;!0===d&&e<b;){h=a[e][0];var q=a[e][1];Math.abs(h-f)<=l&&Math.abs(q-m)<=n&&!0===a[e][2]&&(g=(g*k+h)/(k+1),p=(p*k+q)/(k+1),k+=1,a[e][2]=!1);h>f+2*l&&(d=!1);e+=1}a[c][2]=!1;this._dataSeries.addPixel(parseFloat(g),parseFloat(p))}return this._dataSeries}};wpd=wpd||{};wpd.AveragingWindowAlgo=function(){this._yStep=this._xStep=10;this._wasRun=!1};wpd.AveragingWindowAlgo.prototype.getParamList=function(a){return[["\u0394X","Px",this._xStep],["\u0394Y","Px",this._yStep]]};
wpd.AveragingWindowAlgo.prototype.setParam=function(a,b){0===a?this._xStep=b:1===a&&(this._yStep=b)};wpd.AveragingWindowAlgo.prototype.getParam=function(a){return 0===a?this._xStep:this._yStep};wpd.AveragingWindowAlgo.prototype.serialize=function(){return this._wasRun?{algoType:"AveragingWindowAlgo",xStep:this._xStep,yStep:this._yStep}:null};wpd.AveragingWindowAlgo.prototype.deserialize=function(a){this._xStep=a.xStep;this._yStep=a.yStep;this._wasRun=!0};
wpd.AveragingWindowAlgo.prototype.run=function(a,b,c){this._wasRun=!0;(new wpd.AveragingWindowCore(a.binaryData,a.imageHeight,a.imageWidth,this._xStep,this._yStep,b)).run()};wpd=wpd||{};wpd.AveragingWindowWithStepSizeAlgo=function(){this._xmax=this._xmin=0;this._delx=.1;this._lineWidth=30;this._ymax=this._ymin=0;this._wasRun=!1};
wpd.AveragingWindowWithStepSizeAlgo.prototype.getParamList=function(a){!this._wasRun&&null!=a&&a instanceof wpd.XYAxes&&(a=a.getBounds(),this._xmin=a.x1,this._xmax=a.x2,this._ymin=a.y3,this._ymax=a.y4);return[["X_min","Units",this._xmin],["\u0394X Step","Units",this._delx],["X_max","Units",this._xmax],["Y_min","Units",this._ymin],["Y_max","Units",this._ymax],["Line width","Px",this._lineWidth]]};
wpd.AveragingWindowWithStepSizeAlgo.prototype.setParam=function(a,b){0===a?this._xmin=b:1===a?this._delx=b:2===a?this._xmax=b:3===a?this._ymin=b:4===a?this._ymax=b:5===a&&(this._lineWidth=b)};wpd.AveragingWindowWithStepSizeAlgo.prototype.getParam=function(a){switch(a){case 0:return this._xmin;case 1:return this._delx;case 2:return this._xmax;case 3:return this._ymin;case 4:return this._ymax;case 5:return this._lineWidth;default:return null}};
wpd.AveragingWindowWithStepSizeAlgo.prototype.serialize=function(){return this._wasRun?{algoType:"AveragingWindowWithStepSizeAlgo",xmin:this._xmin,delx:this._delx,xmax:this._xmax,ymin:this._ymin,ymax:this._ymax,lineWidth:this._lineWidth}:null};wpd.AveragingWindowWithStepSizeAlgo.prototype.deserialize=function(a){this._xmin=a.xmin;this._delx=a.delx;this._xmax=a.xmax;this._ymin=a.ymin;this._ymax=a.ymax;this._lineWidth=a.lineWidth;this._wasRun=!0};
wpd.AveragingWindowWithStepSizeAlgo.prototype.run=function(a,b,c){this._wasRun=!0;var d=a.imageWidth,e=a.imageHeight,f,g;b.clearAll();for(f=this._xmin;f<=this._xmax;f+=this._delx){var h=c.dataToPixel(f,this._ymin);var k=h.x;var l=h.y;h=c.dataToPixel(f,this._ymax);var n=h.x;var m=h.y;k=Math.sqrt((m-l)*(m-l)+(n-k)*(n-k));n=(this._ymax-this._ymin)/k;l=!1;var p=m=0;var q=!1;for(g=0;g<=k;g++)h=-g*n+this._ymax,h=c.dataToPixel(f,h),xi_pix=h.x,yi_pix=h.y,0<=xi_pix&&xi_pix<d&&0<=yi_pix&&yi_pix<e&&(a.binaryData.has(parseInt(yi_pix,
10)*d+parseInt(xi_pix,10))?(!1===l&&(p=m=g,l=!0,q=!1),!0===q&&(p=g,q=!1)):!1===q&&(p=g,q=!0),!0===l&&(g>m+this._lineWidth||g==k-1)&&(l=!1,m>p&&(p=g),h=(m+p)/2,h=-h*n+this._ymax,h=c.dataToPixel(f,h),b.addPixel(parseFloat(h.x),parseFloat(h.y))))}};wpd=wpd||{};wpd.BarValue=function(){this.avgX=this.avgValBot=this.avgValTop=this.npoints=0};
wpd.BarValue.prototype.append=function(a,b,c){this.avgX=(this.npoints*this.avgX+a)/(this.npoints+1);this.avgValTop=(this.npoints*this.avgValTop+b)/(this.npoints+1);this.avgValBot=(this.npoints*this.avgValBot+c)/(this.npoints+1);this.npoints++};wpd.BarValue.prototype.isPointInGroup=function(a,b,c,d,e){return 0===this.npoints||Math.abs(this.avgX-a)<=d&&Math.abs(this.avgValTop-b)<=e&&Math.abs(this.avgValBot-c)<=e?!0:!1};wpd.BarExtractionAlgo=function(){this._delX=30;this._delVal=10;this._wasRun=!1};
wpd.BarExtractionAlgo.prototype.getParamList=function(a){return"Y"===a.getOrientation().axes?[["\u0394X","Px",this._delX],["\u0394Val","Px",this._delVal]]:[["\u0394Y","Px",this._delX],["\u0394Val","Px",this._delVal]]};wpd.BarExtractionAlgo.prototype.setParam=function(a,b){0===a?this._delX=parseFloat(b):1===a&&(this._delVal=parseFloat(b))};wpd.BarExtractionAlgo.prototype.getParam=function(a){return 0===a?this._delX:this._delVal};
wpd.BarExtractionAlgo.prototype.serialize=function(){return this._wasRun?{algoType:"BarExtractionAlgo",delX:this._delX,delVal:this._delVal}:null};wpd.BarExtractionAlgo.prototype.deserialize=function(a){this._delX=a.delX;this._delVal=a.delVal;this._wasRun=!0};
wpd.BarExtractionAlgo.prototype.run=function(a,b,c){this._wasRun=!0;var d=c.getOrientation(),e=[],f,g,h,k=a.imageWidth,l=a.imageHeight,n,m,p=function(a,b,c,d,f){n=!1;for(m=0;m<e.length;m++)if(r=e[m],r.isPointInGroup(a,b,c,d,f)){r.append(a,b,c);n=!0;break}n||(r=new wpd.BarValue,r.append(a,b,c),e.push(r))};b.clearAll();if("Y"===d.axes)for(g=0;g<k;g++){var q=0;var t=l-1;for(h=f=0;h<l;h++)if(a.binaryData.has(h*k+g)){q=h;f++;break}for(h=l-1;0<=h;h--)if(a.binaryData.has(h*k+g)){t=h;f++;break}2===f&&p(g,
q,t,this._delX,this._delVal)}else for(h=0;h<l;h++){q=k-1;f=t=0;for(g=k-1;0<=g;g--)if(a.binaryData.has(h*k+g)){q=g;f++;break}for(g=0;g<k;g++)if(a.binaryData.has(h*k+g)){t=g;f++;break}2===f&&p(h,q,t,this._delX,this._delVal)}c.dataPointsHaveLabels&&(a=b.getMetadataKeys(),null!=a&&"Label"===a[0]||b.setMetadataKeys(["Label"]));for(m=0;m<e.length;m++){var r=e[m];"Y"===d.axes?(q=c.pixelToData(r.avgX,r.avgValTop)[0],t=c.pixelToData(r.avgX,r.avgValBot)[0]):(q=c.pixelToData(r.avgValTop,r.avgX)[0],t=c.pixelToData(r.avgValBot,
r.avgX)[0]);a=0>q+t?"increasing"===d.direction?r.avgValBot:r.avgValTop:"increasing"===d.direction?r.avgValTop:r.avgValBot;c.dataPointsHaveLabels?"Y"===d.axes?b.addPixel(r.avgX+.5,a+.5,["Bar"+m]):b.addPixel(a+.5,r.avgX+.5,["Bar"+m]):"Y"===d.axes?b.addPixel(r.avgX+.5,a+.5):b.addPixel(a+.5,r.avgX+.5)}};wpd=wpd||{};wpd.BlobDetectorAlgo=function(){this._minDia=0;this._maxDia=5E3;this._wasRun=!1};
wpd.BlobDetectorAlgo.prototype.getParamList=function(a){return null!=a&&a instanceof wpd.MapAxes?[["Min Diameter","Units",this._minDia],["Max Diameter","Units",this._maxDia]]:[["Min Diameter","Px",this._minDia],["Max Diameter","Px",this._maxDia]]};wpd.BlobDetectorAlgo.prototype.setParam=function(a,b){0===a?this._minDia=parseFloat(b):1===a&&(this._maxDia=parseFloat(b))};
wpd.BlobDetectorAlgo.prototype.serialize=function(){return this._wasRun?{algoType:"BlobDetectorAlgo",minDia:this._minDia,maxDia:this._maxDia}:null};wpd.BlobDetectorAlgo.prototype.deserialize=function(a){this._minDia=a.minDia;this._maxDia=a.maxDia;this._wasRun=!0};wpd.BlobDetectorAlgo.prototype.getParam=function(a){return 0===a?this._minDia:this._maxDia};
wpd.BlobDetectorAlgo.prototype.run=function(a,b,c){this._wasRun=!0;var d=a.imageWidth,e=a.imageHeight,f=[],g=[],h,k,l,n,m;if(!(0>=d||0>=e||null==a.binaryData||0===a.binaryData.size)){b.clearAll();b.setMetadataKeys(["area","moment"]);for(h=0;h<d;h++)for(k=0;k<e;k++)if(a.binaryData.has(k*d+h)&&!0!==f[k*d+h]){f[k*d+h]=!0;var p=g.length;g[p]={pixels:[{x:h,y:k}],centroid:{x:h,y:k},area:1,moment:0};for(l=0;l<g[p].pixels.length;){var q=g[p].pixels[l].x;var t=g[p].pixels[l].y;for(n=q-1;n<=q+1;n++)for(m=t-
1;m<=t+1;m++)if(0<=n&&0<=m&&n<d&&m<e&&!0!==f[m*d+n]&&a.binaryData.has(m*d+n)){f[m*d+n]=!0;var r=g[p].pixels.length;g[p].pixels[r]={x:n,y:m};g[p].centroid.x=(g[p].centroid.x*r+n)/(r+1);g[p].centroid.y=(g[p].centroid.y*r+m)/(r+1);g[p].area+=1}l+=1}}for(p=0;p<g.length;p++){for(l=g[p].moment=0;l<g[p].pixels.length;l++)g[p].moment=g[p].moment+(g[p].pixels[l].x-g[p].centroid.x)*(g[p].pixels[l].x-g[p].centroid.x)+(g[p].pixels[l].y-g[p].centroid.y)*(g[p].pixels[l].y-g[p].centroid.y);c instanceof wpd.MapAxes&&
(g[p].area=plotData.axes.pixelToDataArea(g[p].area));a=2*Math.sqrt(g[p].area/Math.PI);a<=this._maxDia&&a>=this._minDia&&b.addPixel(g[p].centroid.x+.5,g[p].centroid.y+.5,[g[p].area,g[p].moment])}}};wpd=wpd||{};wpd.CustomIndependents=function(){this._xvals=[];this._smoothing=this._ymax=this._ymin=0;this._wasRun=!1};wpd.CustomIndependents.prototype.deserialize=function(a){this._xvals=a.xvals;this._ymin=a.ymin;this._ymax=a.ymax;this._smoothing=a.smoothing;this._wasRun=!0};
wpd.CustomIndependents.prototype.getParam=function(a){switch(a){case 0:return this._xvals;case 1:return this._ymin;case 2:return this._ymax;case 3:return this._smoothing;default:return null}};wpd.CustomIndependents.prototype.setParam=function(a,b){0===a?this._xvals=b:1===a?this._ymin=b:2===a?this._ymax=b:3===a&&(this._smoothing=b)};
wpd.CustomIndependents.prototype.serialize=function(){return this._wasRun?{algoType:"CustomIndependents",xvals:this._xvals,ymin:this._ymin,ymax:this._ymax,smoothing:this._smoothing}:null};wpd.CustomIndependents.prototype.run=function(a,b,c){this._wasRun=!0;b.clearAll();c.isLogX();c.isLogY()};wpd=wpd||{};wpd.XStepWithInterpolationAlgo=function(){this._xmin=0;this._xmax=1;this._delx=.1;this._ymax=this._ymin=this._smoothing=0;this._wasRun=!1};
wpd.XStepWithInterpolationAlgo.prototype.getParamList=function(a){!this._wasRun&&null!=a&&a instanceof wpd.XYAxes&&(a=a.getBounds(),this._xmin=a.x1,this._xmax=a.x2,this._delx=(a.x2-a.x1)/50,this._ymin=a.y3,this._ymax=a.y4,this._smoothing=0);return[["X_min","Units",this._xmin],["\u0394X Step","Units",this._delx],["X_max","Units",this._xmax],["Y_min","Units",this._ymin],["Y_max","Units",this._ymax],["Smoothing","% of \u0394X",this._smoothing]]};
wpd.XStepWithInterpolationAlgo.prototype.setParam=function(a,b){0===a?this._xmin=b:1===a?this._delx=b:2===a?this._xmax=b:3===a?this._ymin=b:4===a?this._ymax=b:5===a&&(this._smoothing=b)};wpd.XStepWithInterpolationAlgo.prototype.getParam=function(a){switch(a){case 0:return this._xmin;case 1:return this._delx;case 2:return this._xmax;case 3:return this._ymin;case 4:return this._ymax;case 5:return this._smoothing;default:return null}};
wpd.XStepWithInterpolationAlgo.prototype.serialize=function(){return this._wasRun?{algoType:"XStepWithInterpolationAlgo",xmin:this._xmin,delx:this._delx,xmax:this._xmax,ymin:this._ymin,ymax:this._ymax,smoothing:this._smoothing}:null};wpd.XStepWithInterpolationAlgo.prototype.deserialize=function(a){this._xmin=a.xmin;this._delx=a.delx;this._xmax=a.xmax;this._ymin=a.ymin;this._ymax=a.ymax;this._smoothing=a.smoothing;this._wasRun=!0};
wpd.XStepWithInterpolationAlgo.prototype.run=function(a,b,c){this._wasRun=!0;var d=0,e=a.imageWidth,f=a.imageHeight,g,h,k=[],l=[],n=Math.abs(this._smoothing/100*this._delx),m=c.isLogX(),p=c.isLogY();c.isDate(0);c.isDate(1);var q=this._xmin;var t=this._xmax;var r=this._ymin,x=this._ymax,y=n,B=this._delx;b.clearAll();m&&(t=Math.log10(t),q=Math.log10(q),y=Math.abs(Math.log10(this._delx)*this._smoothing/100),B=Math.log10(B));p&&(r=Math.log10(r),x=Math.log10(x));var w=c.dataToPixel(this._xmin,this._ymin);
var v=c.dataToPixel(this._xmin,this._ymax);var z=(x-r)/Math.sqrt((w.x-v.x)*(w.x-v.x)+(w.y-v.y)*(w.y-v.y));v=c.dataToPixel(this._xmax,this._ymin);v=(t-q)/Math.sqrt((w.x-v.x)*(w.x-v.x)+(w.y-v.y)*(w.y-v.y));0<Math.abs(y/v)&&1>Math.abs(y/v)&&(y=v);for(w=0<v?q-2*v:q+2*v;0<v&&w<=t+2*v||0>v&&w>=t-2*v;){var u=h=0;for(g=r;0<z&&g<=x||0>z&&g>=x;){var C=c.dataToPixel(m?Math.pow(10,w):w,p?Math.pow(10,g):g);0<=C.x&&0<=C.y&&C.x<e&&C.y<f&&a.binaryData.has(parseInt(C.y,10)*e+parseInt(C.x,10))&&(h=(h*u+g)/parseFloat(u+
1),u++);g+=z}0<u&&(k[d]=parseFloat(w),l[d]=parseFloat(h),d+=1);w+=v}if(!(0>=k.length||0>=l.length)){if(0<y)for(C=[],d=[],w=k[0];0<v&&w<=k[k.length-1]||0>v&&w>=k[k.length-1];){for(a=u=f=e=0;a<k.length;a++)k[a]<=w+y&&k[a]>=w-y&&(e=(e*u+k[a])/parseFloat(u+1),f=(f*u+l[a])/parseFloat(u+1),u++);0<u&&(C[C.length]=e,d[d.length]=f);w=0<v?w+n:w-n}else C=k,d=l;if(!(0>=C.length||0>=d.length||(k=[],a=0,w=q,0>v&&0<this._delx||0<v&&0>this._delx))){for(;0<v&&w<=t||0>v&&w>=t;)k[a]=w,a++,w+=B;0>v&&(C=C.reverse(),d=
d.reverse());t=wpd.cspline(C,d);if(null!=t)for(q=[],a=0;a<k.length;++a)isNaN(k[a])||(q[a]=wpd.cspline_interp(t,k[a]),null!==q[a]&&(C=c.dataToPixel(m?Math.pow(10,k[a]):k[a],p?Math.pow(10,q[a]):q[a]),b.addPixel(C.x,C.y)))}}};wpd=wpd||{};
wpd.BarAxes=function(){var a=function(){var a=!1,c=!1,d=!1,e,f,g,h,k,l,n;this.isCalibrated=function(){return a};this.calibration=null;this.calibrate=function(b,p,q){this.calibration=b;a=!1;var m=b.getPoint(0);b=b.getPoint(1);e=m.px;f=m.py;g=b.px;h=b.py;k=parseFloat(m.dy);l=parseFloat(b.dy);p?(c=!0,k=Math.log(k)/Math.log(10),l=Math.log(l)/Math.log(10)):c=!1;n=this.calculateOrientation();d=q;q||("Y"==n.axes?g=e:h=f,n=this.calculateOrientation());return a=!0};this.pixelToData=function(a,b){var d=[];
d[0]=((b-f)*(h-f)+(g-e)*(a-e))/((h-f)*(h-f)+(g-e)*(g-e))*(l-k)+k;c&&(d[0]=Math.pow(10,d[0]));return d};this.dataToPixel=function(a,b){return{x:0,y:0}};this.pixelToLiveString=function(a,b){return this.pixelToData(a,b)[0].toExponential(4)};this.isLog=function(){return c};this.isRotated=function(){return d};this.getTransformationEquations=function(){return{pixelToData:["This will be available in a future release."]}};this.dataPointsHaveLabels=!0;this.dataPointsLabelPrefix="Bar";this.calculateOrientation=
function(){var a=180*wpd.taninverse(-(h-f),g-e)/Math.PI,b={axes:"Y",direction:"increasing",angle:a};30>Math.abs(a-90)?(b.axes="Y",b.direction="increasing"):30>Math.abs(a-270)?(b.axes="Y",b.direction="decreasing"):30>Math.abs(a-0)||30>Math.abs(a-360)?(b.axes="X",b.direction="increasing"):30>Math.abs(a-180)&&(b.axes="X",b.direction="decreasing");return b};this.getOrientation=function(){return n};this.name="Bar"};a.prototype.numCalibrationPointsRequired=function(){return 2};a.prototype.getDimensions=
function(){return 2};a.prototype.getAxesLabels=function(){return["Label","Y"]};return a}();wpd=wpd||{};
wpd.ImageAxes=function(){var a=function(){this.isCalibrated=function(){return!0};this.calibrate=function(){return!0};this.pixelToData=function(a,c){return[a,c]};this.dataToPixel=function(a,c){return{x:a,y:c}};this.pixelToLiveString=function(a,c){a=this.pixelToData(a,c);return a[0].toFixed(2)+", "+a[1].toFixed(2)};this.getTransformationEquations=function(){return{pixelToData:["x_data = x_pixel","y_data = y_pixel"],dataToPixel:["x_pixel = x_data","y_pixel = y_data"]}};this.name="Image"};a.prototype.numCalibrationPointsRequired=
function(){return 0};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();wpd=wpd||{};
wpd.MapAxes=function(){var a=function(){var a=!1,c,d,e;this.calibration=null;this.isCalibrated=function(){return a};this.calibrate=function(b,g,h){this.calibration=b;var f=b.getPoint(0);b=b.getPoint(1);e=Math.sqrt((f.px-b.px)*(f.px-b.px)+(f.py-b.py)*(f.py-b.py));c=parseFloat(g);d=h;return a=!0};this.pixelToData=function(a,b){var d=[];d[0]=a*c/e;d[1]=b*c/e;return d};this.pixelToDataDistance=function(a){return a*c/e};this.pixelToDataArea=function(a){return a*c*c/(e*e)};this.dataToPixel=function(a,b,
c){return{x:0,y:0}};this.pixelToLiveString=function(a,b){a=this.pixelToData(a,b);return a[0].toExponential(4)+", "+a[1].toExponential(4)};this.getScaleLength=function(){return c};this.getUnits=function(){return d};this.getTransformationEquations=function(){return{pixelToData:["x_data = "+c/e+"*x_pixel","y_data = "+c/e+"*y_pixel"],dataToPixel:["x_pixel = "+e/c+"*x_data","y_pixel = "+e/c+"*y_data"]}};this.name="Map"};a.prototype.numCalibrationPointsRequired=function(){return 2};a.prototype.getDimensions=
function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();wpd=wpd||{};
wpd.PolarAxes=function(){var a=function(){var a=!1,c=!1,d=!1,e=!1,f,g,h,k,l,n,m,p,q,t,r,x,y,B;this.calibration=null;this.isCalibrated=function(){return a};this.calibrate=function(b,v,z,u){this.calibration=b;var w=b.getPoint(0),G=b.getPoint(1);b=b.getPoint(2);f=w.px;g=w.py;h=G.px;k=G.py;l=b.px;n=b.py;m=G.dx;p=G.dy;q=b.dx;c=v;d=z;!0===c&&(p*=Math.PI/180);u&&(e=!0,m=Math.log(m)/Math.log(10),q=Math.log(q)/Math.log(10));t=Math.sqrt((h-f)*(h-f)+(k-g)*(k-g));r=Math.sqrt((l-f)*(l-f)+(n-g)*(n-g));x=r-t;y=
wpd.taninverse(-(k-g),h-f);B=d?y+p:y-p;return a=!0};this.isThetaDegrees=function(){return c};this.isThetaClockwise=function(){return d};this.isRadialLog=function(){return e};this.pixelToData=function(a,b){var h=[];a=parseFloat(a);var k=parseFloat(b);b=(q-m)/x*(Math.sqrt((a-f)*(a-f)+(k-g)*(k-g))-t)+m;a=d?B-wpd.taninverse(-(k-g),a-f):wpd.taninverse(-(k-g),a-f)-B;0>a&&(a+=2*Math.PI);!0===c&&(a=180*a/Math.PI);e&&(b=Math.pow(10,b));h[0]=b;h[1]=a;return h};this.dataToPixel=function(a,b){return{x:0,y:0}};
this.pixelToLiveString=function(a,b){a=this.pixelToData(a,b);return a[0].toExponential(4)+", "+a[1].toExponential(4)};this.getTransformationEquations=function(){var a="r = ("+(q-m)/x+")*sqrt((x_pixel - "+f+")^2 + (y_pixel - "+g+")^2) + ("+(m-t*(q-m)/x)+")";var b=d?B+"- atan2(("+g+" - y_pixel), (x_pixel - "+f+"))":"atan2(("+g+" - y_pixel), (x_pixel - "+f+")) - ("+B+")";b=c?"theta = (180/PI)*("+b+"), theta = theta + 360 if theta < 0":"theta = "+b+" theta = theta + 2*PI if theta < 0";return{pixelToData:[a,
b]}};this.name="Polar"};a.prototype.numCalibrationPointsRequired=function(){return 3};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=function(){return["r","\u03b8"]};return a}();wpd=wpd||{};
wpd.TernaryAxes=function(){var a=function(){var a=!1,c,d,e,f,g,h,k,l,n;this.isCalibrated=function(){return a};this.calibration=null;this.calibrate=function(b,p,q){this.calibration=b;var m=b.getPoint(0),r=b.getPoint(1);b.getPoint(2);c=m.px;d=m.py;e=r.px;f=r.py;g=Math.sqrt((c-e)*(c-e)+(d-f)*(d-f));h=wpd.taninverse(-(f-d),e-c);k=Math.sqrt(3);l=p;n=q;return a=!0};this.isRange100=function(){return l};this.isNormalOrientation=function(){return n};this.pixelToData=function(a,b){var e=[];a=parseFloat(a);
var f=parseFloat(b);b=Math.sqrt((a-c)*(a-c)+(f-d)*(f-d));f=wpd.taninverse(-(f-d),a-c)-h;a=b*Math.cos(f)/g;f=b*Math.sin(f)/g;b=1-a-f/k;a-=f/k;f=2*f/k;if(0==n){var m=a;a=b;b=f;f=m}1==l&&(b*=100,a*=100,f*=100);e[0]=b;e[1]=a;e[2]=f;return e};this.dataToPixel=function(a,b,c){return{x:0,y:0}};this.pixelToLiveString=function(a,b){a=this.pixelToData(a,b);return a[0].toExponential(4)+", "+a[1].toExponential(4)+", "+a[2].toExponential(4)};this.getTransformationEquations=function(){var a="rp = sqrt((x_pixel - "+
c+")^2 + (y_pixel - "+d+")^2)/("+g+")",b="thetap = atan2(("+d+" -  y_pixel), (x_pixel - "+c+")) - ("+Math.atan2(-(f-d),e-c)+")",h="1 - rp*(cos(thetap) - sin(thetap)/sqrt(3))",k="rp*(cos(thetap) - sin(thetap)/sqrt(3))",r="2*rp*sin(thetap)/sqrt(3)";l&&(h="100*("+h+")",k="100*("+k+")",r="100*("+r+")");h="a_data = "+h;k="b_data = "+k;r="c_data = "+r;if(!n){var x=k;k=h;h=r;r=x}return{pixelToData:[a,b,h,k,r]}};this.name="Ternary"};a.prototype.numCalibrationPointsRequired=function(){return 3};a.prototype.getDimensions=
function(){return 3};a.prototype.getAxesLabels=function(){return["a","b","c"]};return a}();wpd=wpd||{};
wpd.XYAxes=function(){var a=function(){var a=!1,c=!1,d=!1,e=!1,f=!1,g,h,k,l,n,m,p,q,t,r,x,y,B,w,v=[0,0,0,0],z=[0,0,0,0],u=[0,0],C=function(a,b,C){if(4>a.getCount())return!1;var G=a.getPoint(0),K=a.getPoint(1),J=a.getPoint(2);a=a.getPoint(3);var D=new wpd.InputParser;k=G.px;p=G.py;l=K.px;q=K.py;n=J.px;t=J.py;m=a.px;r=a.py;x=G.dx;y=K.dx;B=J.dy;w=a.dy;x=D.parse(x);if(!D.isValid)return!1;e=D.isDate;y=D.parse(y);if(!D.isValid||D.isDate!=e)return!1;g=D.formatting;B=D.parse(B);if(!D.isValid)return!1;f=D.isDate;
w=D.parse(w);if(!D.isValid||D.isDate!=f)return!1;h=D.formatting;c=b;d=C;!0===c&&(x=Math.log(x)/Math.log(10),y=Math.log(y)/Math.log(10));!0===d&&(B=Math.log(B)/Math.log(10),w=Math.log(w)/Math.log(10));v=wpd.mat.mult2x2([x-y,0,0,B-w],wpd.mat.inv2x2([k-l,n-m,p-q,t-r]));z=wpd.mat.inv2x2(v);u[0]=x-v[0]*k-v[1]*p;u[1]=B-v[2]*n-v[3]*t;return!0};this.getBounds=function(){return{x1:c?Math.pow(10,x):x,x2:c?Math.pow(10,y):y,y3:d?Math.pow(10,B):B,y4:d?Math.pow(10,w):w}};this.isCalibrated=function(){return a};
this.calibration=null;this.calibrate=function(b,c,e){this.calibration=b;return a=C(b,c,e)};this.pixelToData=function(a,b){var e=[];a=parseFloat(a);b=parseFloat(b);a=wpd.mat.mult2x2Vec(v,[a,b]);a[0]+=u[0];a[1]+=u[1];b=a[0];a=a[1];!0===c&&(b=Math.pow(10,b));!0===d&&(a=Math.pow(10,a));e[0]=b;e[1]=a;return e};this.dataToPixel=function(a,b){c&&(a=Math.log(a)/Math.log(10));d&&(b=Math.log(b)/Math.log(10));a=wpd.mat.mult2x2Vec(z,[a-u[0],b-u[1]]);return{x:a[0],y:a[1]}};this.pixelToLiveString=function(a,b){var c=
"";a=this.pixelToData(a,b);c=e?c+wpd.dateConverter.formatDateNumber(a[0],g):c+a[0].toExponential(4);c+=", ";return c=f?c+wpd.dateConverter.formatDateNumber(a[1],h):c+a[1].toExponential(4)};this.isDate=function(a){return 0===a?e:f};this.getInitialDateFormat=function(a){return 0===a?g:h};this.isLogX=function(){return c};this.isLogY=function(){return d};this.getTransformationEquations=function(){var a="("+v[0]+")*x_pixel + ("+v[1]+")*y_pixel + ("+u[0]+")",b="("+v[2]+")*x_pixel + ("+v[3]+")*y_pixel + ("+
u[1]+")",e="x_pixel = ("+z[0]+")*x_data + ("+z[1]+")*y_data + ("+(-z[0]*u[0]-z[1]*u[1])+")",f="y_pixel = ("+z[2]+")*x_data + ("+z[3]+")*y_data + ("+(-z[2]*u[0]-z[3]*u[1])+")";a=c?"x_data = pow(10, "+a+")":"x_data = "+a;b=d?"y_data = pow(10, "+b+")":"y_data = "+b;return c||d?{pixelToData:[a,b]}:{pixelToData:[a,b],dataToPixel:[e,f]}};this.getOrientation=function(){return{axes:"Y",direction:"increasing",angle:90}};this.name="XY"};a.prototype.numCalibrationPointsRequired=function(){return 4};a.prototype.getDimensions=
function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();wpd=wpd||{};
wpd.dataTable=function(){function a(){wpd.graphicsWidget.removeTool();wpd.popup.show("csvWindow");document.getElementById("data-number-format-separator").value.trim()===p&&(document.getElementById("data-number-format-separator").value=","===p?"; ":", ");b()}function b(){h=g.getData();c();e();f()}function c(){var a=document.getElementById("data-table-dataset-list"),b=document.getElementById("data-sort-variables"),c=document.getElementById("dataVariables"),e=document.getElementById("data-date-formatting-container"),
f=document.getElementById("data-date-formatting"),g="",k="",l="",p=!1,u=null!=m;null!=n?(wpd.appData.getPlotData().getDatasetNames().forEach(function(a){g+='<option value="'+a+'">'+a+"</option>"}),a.innerHTML=g,a.value=n.name):u&&(0<wpd.appData.getPlotData().getMeasurementsByType(wpd.AreaMeasurement).length&&(g+='<option value="area">'+wpd.gettext("area-measurements")+"</option>"),0<wpd.appData.getPlotData().getMeasurementsByType(wpd.AngleMeasurement).length&&(g+='<option value="angle">'+wpd.gettext("angle-measurements")+
"</option>"),0<wpd.appData.getPlotData().getMeasurementsByType(wpd.DistanceMeasurement).length&&(g+='<option value="distance">'+wpd.gettext("distance-measurements")+"</option>"),a.innerHTML=g,m instanceof wpd.AngleMeasurement?a.value="angle":m instanceof wpd.DistanceMeasurement?a.value="distance":m instanceof wpd.AreaMeasurement&&(a.value="area"));c.innerHTML=h.fields.join(", ");e.style.display="none";k+='<option value="raw">'+wpd.gettext("raw")+"</option>";for(a=0;a<h.fields.length;a++)h.isFieldSortable[a]&&
(k+='<option value="'+h.fields[a]+'">'+h.fields[a]+"</option>"),null!=h.fieldDateFormat[a]&&(l+="<p>"+h.fields[a]+' <input type="text" length="15" value="'+h.fieldDateFormat[a]+'" id="data-format-string-'+a+'"/></p>',p=!0);h.allowConnectivity&&(k+='<option value="NearestNeighbor">'+wpd.gettext("nearest-neighbor")+"</option>");b.innerHTML=k;d();p?(e.style.display="inline-block",f.innerHTML=l):e.style.display="hidden"}function d(){var a=document.getElementById("data-sort-variables").value,b=document.getElementById("data-sort-order");
"NearestNeighbor"===a||"raw"===a?b.setAttribute("disabled",!0):b.removeAttribute("disabled")}function e(){if(null!=h&&null!=h.rawData){k=h.rawData.slice(0);var a=document.getElementById("data-sort-variables").value,b="ascending"===document.getElementById("data-sort-order").value,c="NearestNeighbor"===a;if("raw"!==a)if(!c){var e=h.fields.indexOf(a);0>e||k.sort(function(a,c){return a[e]>c[e]?b?1:-1:a[e]<c[e]?b?-1:1:0})}else if(c){var d,f,g=k.length,l=h.connectivityFieldIndices,n;for(c=0;c<g-1;c++){a=
-1;for(f=c+1;f<g;f++){for(n=d=0;n<l.length;n++){var m=l[n];d+=(k[c][m]-k[f][m])*(k[c][m]-k[f][m])}if(d<p||-1===a){var p=d;a=f}}for(n=0;n<h.fields.length;n++)d=k[a][n],k[a][n]=k[c+1][n],k[c+1][n]=d}}}}function f(){if(null!=k){var a=document.getElementById("digitizedDataTable"),b=parseInt(document.getElementById("data-number-format-digits").value,10),c=document.getElementById("data-number-format-style").value,e=document.getElementById("data-number-format-separator").value,d,f,g=[];e=e.replace(/[^\\]\\t/,
"\t").replace(/^\\t/,"\t");l="";for(d=0;d<k.length;d++){var n=[];for(f=0;f<h.fields.length;f++)null!=h.fieldDateFormat[f]?(void 0===g[f]&&(g[f]=document.getElementById("data-format-string-"+f).value),n[f]=wpd.dateConverter.formatDateNumber(k[d][f],g[f])):(n[f]="string"===typeof k[d][f]?k[d][f]:"fixed"===c&&0<=b?k[d][f].toFixed(b):"precision"===c&&0<=b?k[d][f].toPrecision(b):"exponential"===c&&0<=b?k[d][f].toExponential(b):k[d][f],n[f]=n[f].toString().replace(".",p));l+=n.join(e);l+="\n"}a.value=l}}
var g,h,k,l,n,m,p=(1.1).toLocaleString().replace(/\d/g,"");return{showTable:function(){g=wpd.plotDataProvider;n=wpd.tree.getActiveDataset();m=null;g.setDataSource(n);a()},showAngleData:function(){g=wpd.measurementDataProvider;m=wpd.appData.getPlotData().getMeasurementsByType(wpd.AngleMeasurement)[0];n=null;g.setDataSource(m);a()},showAreaData:function(){g=wpd.measurementDataProvider;m=wpd.appData.getPlotData().getMeasurementsByType(wpd.AreaMeasurement)[0];n=null;g.setDataSource(m);a()},showDistanceData:function(){g=
wpd.measurementDataProvider;m=wpd.appData.getPlotData().getMeasurementsByType(wpd.DistanceMeasurement)[0];n=null;g.setDataSource(m);a()},updateSortingControls:d,reSort:function(){d();e();f()},copyToClipboard:function(){var a=document.getElementById("digitizedDataTable");a.focus();a.select();try{document.execCommand("copy")}catch(t){console.log("copyToClipboard",t.message)}},generateCSV:function(){wpd.download.csv(l,(null!=n?n.name:m instanceof wpd.AngleMeasurement?"angles":"distances")+".csv")},exportToPlotly:function(){if(null!=
k){var a={data:[]},b,c;a.data[0]={};for(b=0;b<k.length;b++)for(c=0;c<h.fields.length;c++){var e=h.fields[c];0===c?e="x":1===c&&(e="y");0===b&&(a.data[0][e]=[]);a.data[0][e][b]=null!=h.fieldDateFormat[c]?wpd.dateConverter.formatDateNumber(k[b][c],"yyyy-mm-dd hh:ii:ss"):k[b][c]}wpd.plotly.send(a)}},changeDataset:function(){var a=document.getElementById("data-table-dataset-list");null!=n?(n=wpd.appData.getPlotData().getDatasets()[a.selectedIndex],g.setDataSource(n)):null!=m&&("angle"===a.value?m=wpd.appData.getPlotData().getMeasurementsByType(wpd.AngleMeasurement)[0]:
"distance"===a.value?m=wpd.appData.getPlotData().getMeasurementsByType(wpd.DistanceMeasurement)[0]:"area"===a.value&&(m=wpd.appData.getPlotData().getMeasurementsByType(wpd.AreaMeasurement)[0]),g.setDataSource(m));b()}}}();wpd=wpd||{};
wpd.graphicsWidget=function(){function a(a){var b=B.getBoundingClientRect();return{x:parseInt(a.pageX-(b.left+window.pageXOffset),10),y:parseInt(a.pageY-(b.top+window.pageYOffset),10)}}function b(a,b){return{x:a/I,y:b/I}}function c(a,b){a=parseInt(a,10);b=parseInt(b,10);K.style.width=a+"px";K.style.height=b+"px";B.width=a;w.width=a;v.width=a;z.width=a;u.width=a;B.height=b;w.height=b;v.height=b;z.height=b;u.height=b;L=a;M=b;if(null!=O){J.fillStyle="rgb(255, 255, 255)";J.fillRect(0,0,L,M);J.drawImage(C,
0,0,L,M);if(null!=H&&void 0!=H.onRedraw)H.onRedraw();if(null!=A&&void 0!=A.onRedraw)A.onRedraw()}}function d(){w.width=w.width;v.width=v.width;z.width=z.width;u.width=u.width;G.width=G.width}function e(){if(null!=H&&void 0!=H.onRemove)H.onRemove();H=null}function f(){var a=wpd.layoutManager.getGraphicsViewportSize();a.width/(1*a.height)>P?(I=a.height/(1*E),c(a.height*P,a.height)):(I=a.width/(1*F),c(a.width,a.width/P))}function g(a){I=a;c(F*I,E*I)}function h(){Q=!Q;var a=document.getElementById("extended-crosshair-btn");
Q?a.classList.add("pressed-button"):a.classList.remove("pressed-button");u.width=u.width}function k(a,b){var c=wpd.zoomView.getSize(),e=wpd.zoomView.getZoomRatio(),d=0,f=0,g=c.width,h=c.height;var k=c.width/e;c=c.height/e;var l=a-k/2;var n=b-c/2;a=l;b=n;var m=l+k;var p=n+c;0>l&&(a=0,d=-l*e);0>n&&(b=0,f=-n*e);l+k>=F&&(m=F,g-=e*(F-(l+k)));n+c>=E&&(p=E,h-=e*(E-(n+c)));k=N.getImageData(parseInt(a,10),parseInt(b,10),parseInt(m-a,10),parseInt(p-b,10));c=R.getImageData(parseInt(a,10),parseInt(b,10),parseInt(m-
a,10),parseInt(p-b,10));for(m=0;m<c.data.length;m+=4)if(0!=c.data[m]||0!=c.data[m+1]||0!=c.data[m+2])l=c.data[m+3]/255,k.data[m]=(1-l)*k.data[m]+l*c.data[m],k.data[m+1]=(1-l)*k.data[m+1]+l*c.data[m+1],k.data[m+2]=(1-l)*k.data[m+2]+l*c.data[m+2];a=e*(parseInt(a,10)-a);e*=parseInt(b,10)-b;wpd.zoomView.setZoomImage(k,parseInt(d+a,10),parseInt(f+e,10),parseInt(g-d,10),parseInt(h-f,10))}function l(c){clearTimeout(W);var e=setTimeout,d=a(c);c=d.x;d=d.y;var f=b(c,d);Q&&(u.width=u.width,D.strokeStyle="rgba(0,0,0, 0.5)",
D.beginPath(),D.moveTo(c,0),D.lineTo(c,M),D.moveTo(0,d),D.lineTo(L,d),D.stroke());k(f.x,f.y);wpd.zoomView.setCoords(f.x,f.y);W=e(void 0,10)}function n(){B=document.getElementById("mainCanvas");w=document.getElementById("dataCanvas");v=document.getElementById("drawCanvas");z=document.getElementById("hoverCanvas");u=document.getElementById("topCanvas");C=document.createElement("canvas");G=document.createElement("canvas");J=B.getContext("2d");S=w.getContext("2d");V=z.getContext("2d");D=u.getContext("2d");
U=v.getContext("2d");N=C.getContext("2d");R=G.getContext("2d");K=document.getElementById("canvasDiv");document.addEventListener("keydown",function(a){T&&220===a.keyCode&&(a.preventDefault(),h())},!1);u.addEventListener("mousemove",l,!1);u.addEventListener("dragover",function(a){a.preventDefault()},!0);u.addEventListener("drop",function(a){a.preventDefault();wpd.busyNote.show();a=a.dataTransfer.files;1===a.length&&wpd.imageManager.loadFromFile(a[0])},!0);u.addEventListener("mousemove",p,!1);u.addEventListener("click",
q,!1);u.addEventListener("mouseup",r,!1);u.addEventListener("mousedown",x,!1);u.addEventListener("mouseout",y,!0);document.addEventListener("mouseup",t,!1);document.addEventListener("mousedown",function(a){T=a.target===u?!0:!1},!1);document.addEventListener("keydown",function(a){if(T&&null!=A&&void 0!=A.onKeyDown)A.onKeyDown(a)},!0);wpd.zoomView.initZoom();window.addEventListener("paste",function(a){if(void 0!==a.clipboardData&&(a=a.clipboardData.items,void 0!==a))for(var b=0;b<a.length;b++)if(-1!==
a[b].type.indexOf("image")){wpd.busyNote.show();var c=a[b].getAsFile();wpd.imageManager.loadFromFile(c)}},!1)}function m(){if(null!=A&&void 0!=A.onRemove)A.onRemove();A=null}function p(c){if(null!=A&&void 0!=A.onMouseMove){var e=a(c),d=b(e.x,e.y);A.onMouseMove(c,e,d)}}function q(c){if(null!=A&&void 0!=A.onMouseClick){var e=a(c),d=b(e.x,e.y);A.onMouseClick(c,e,d)}}function t(c){if(null!=A&&void 0!=A.onDocumentMouseUp){var e=a(c),d=b(e.x,e.y);A.onDocumentMouseUp(c,e,d)}}function r(c){if(null!=A&&void 0!=
A.onMouseUp){var e=a(c),d=b(e.x,e.y);A.onMouseUp(c,e,d)}}function x(c){if(null!=A&&void 0!=A.onMouseDown){var e=a(c),d=b(e.x,e.y);A.onMouseDown(c,e,d)}}function y(c){if(null!=A&&void 0!=A.onMouseOut){var e=a(c),d=b(e.x,e.y);A.onMouseOut(c,e,d)}}var B,w,v,z,u,C,G,K,J,S,U,V,D,N,R,L,M,F,E,P,O,I,Q=!1,W,A,H,T=!1;return{zoomIn:function(){g(1.2*I)},zoomOut:function(){g(I/1.2)},zoomFit:f,zoom100perc:function(){g(1)},toggleExtendedCrosshairBtn:h,setZoomRatio:g,getZoomRatio:function(){return I},runImageOp:function(a){var b=
a(O,F,E);a=b.imageData;var c=b.width,h=b.height;b=b.keepZoom;m();e();F=c;E=h;P=F/(1*E);C.width=F;C.height=E;G.width=F;G.height=E;N.putImageData(a,0,0);O=a;B.width=B.width;d();b?g(I):f()},setTool:function(a){if(null!=A&&void 0!=A.onRemove)A.onRemove();A=a;if(null!=A&&void 0!=A.onAttach)A.onAttach()},removeTool:m,getAllContexts:function(){return{mainCtx:J,dataCtx:S,drawCtx:U,hoverCtx:V,topCtx:D,oriImageCtx:N,oriDataCtx:R}},resetData:function(){G.width=G.width;w.width=w.width},resetHover:function(){z.width=
z.width},imagePx:b,screenPx:function(a,b){return{x:a*I,y:b*I}},updateZoomOnEvent:function(c){c=a(c);c=b(c.x,c.y);k(c.x,c.y);wpd.zoomView.setCoords(c.x,c.y)},updateZoomToImagePosn:function(a,b){k(a,b);wpd.zoomView.setCoords(a,b)},getDisplaySize:function(){return{width:L,height:M}},getImageSize:function(){return{width:F,height:E}},copyImageDataLayerToScreen:function(){S.drawImage(G,0,0,L,M)},setRepainter:function(a){if(null!=H&&void 0!=H.onRemove)H.onRemove();H=a;if(null!=H&&void 0!=H.onAttach)H.onAttach()},
removeRepainter:e,forceHandlerRepaint:function(){if(null!=H&&void 0!=H.onForcedRedraw)H.onForcedRedraw()},getRepainter:function(){return H},saveImage:function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c;a.width=F;a.height=E;b.drawImage(C,0,0,F,E);var e=b.getImageData(0,0,F,E);var d=R.getImageData(0,0,F,E);for(c=0;c<e.data.length;c+=4)if(0!=d.data[c]||0!=d.data[c+1]||0!=d.data[c+2]){var f=d.data[c+3]/255;e.data[c]=(1-f)*e.data[c]+f*d.data[c];e.data[c+1]=(1-f)*e.data[c+1]+f*d.data[c+
1];e.data[c+2]=(1-f)*e.data[c+2]+f*d.data[c+2]}b.putImageData(e,0,0);window.open(a.toDataURL(),"_blank")},loadImage:function(a){null==B&&n();m();e();F=a.width;E=a.height;P=F/(1*E);C.width=F;C.height=E;G.width=F;G.height=E;N.drawImage(a,0,0,F,E);O=N.getImageData(0,0,F,E);B.width=B.width;d();f();return O},getImagePNG:function(){var a=C.toDataURL("image/png");a=atob(a.split(",")[1]);for(var b=a.length,c=new Uint8Array(b);b--;)c[b]=a.charCodeAt(b);return imageFile=new Blob([c],{type:"image/png",encoding:"utf-8"})}}}();
wpd=wpd||{};
wpd.layoutManager=function(){function a(){var a=parseInt(document.body.offsetWidth,10),b=parseInt(document.body.offsetHeight,10);e.style.height=b+"px";f.style.height=b-280+"px";g.style.width=a-e.offsetWidth-5+"px";g.style.height=b+"px";d.style.height=b-45+"px";h.style.height=b-45+"px";wpd.sidebar.resize()}function b(b){clearTimeout(c);c=setTimeout(a,80)}var c,d,e,f,g,h;return{initialLayout:function(){d=document.getElementById("graphicsContainer");e=document.getElementById("sidebarContainer");f=document.getElementById("sidebarControlsContainer");
g=document.getElementById("mainContainer");h=document.getElementById("left-side-container");a();window.addEventListener("resize",b,!1);wpd.tree.init()},getGraphicsViewportSize:function(){return{width:d.offsetWidth,height:d.offsetHeight}}}}();wpd=wpd||{};
wpd.popup=function(){function a(a){document.getElementById("shadow").style.visibility="hidden";document.getElementById(a).style.visibility="hidden";g();window.removeEventListener("keydown",h,!1);l=null}function b(a){var b=document.createElement("div");b.className="popup-drag-mask";b.style.display="inline-block";b.addEventListener("mousemove",c,!1);b.addEventListener("mouseup",d,!1);b.addEventListener("mouseout",f,!1);document.body.appendChild(b);k={dragMaskDiv:b,initialMouseX:a.pageX,initialMouseY:a.pageY,
initialWindowX:l.offsetLeft,initialWindowY:l.offsetTop};a.preventDefault();a.stopPropagation()}function c(a){e(a);a.stopPropagation();a.preventDefault()}function d(a){e(a);g();a.stopPropagation();a.preventDefault()}function e(a){var b=k.initialWindowX+a.pageX-k.initialMouseX;a=k.initialWindowY+a.pageY-k.initialMouseY;var c=parseInt(document.body.offsetWidth,10),e=parseInt(document.body.offsetHeight,10),d=parseInt(l.offsetWidth,10),f=parseInt(l.offsetHeight,10);b+.7*d<c&&0<b&&0<a&&a+.5*f<e&&(l.style.top=
a+"px",l.style.left=b+"px")}function f(a){g()}function g(){null!=k&&null!=k.dragMaskDiv&&(k.dragMaskDiv.removeEventListener("mouseout",f,!1),k.dragMaskDiv.removeEventListener("mouseup",d,!1),k.dragMaskDiv.removeEventListener("mousemove",c,!1),k.dragMaskDiv.style.display="none",document.body.removeChild(k.dragMaskDiv),k=null)}function h(b){wpd.keyCodes.isEsc(b.keyCode)&&a(l.id)}var k=null,l=null;return{show:function(a){document.getElementById("shadow").style.visibility="visible";a=document.getElementById(a);
var c=parseInt(window.innerWidth,10),e=parseInt(window.innerHeight,10),d=parseInt(a.offsetWidth,10),f=parseInt(a.offsetHeight,10);e=(e-f)/2;a.style.left=(c-d)/2+"px";a.style.top=(60<e?60:e)+"px";a.style.visibility="visible";for(c=0;c<a.childNodes.length;c++)if("popupheading"===a.childNodes[c].className){a.childNodes[c].addEventListener("mousedown",b,!1);break}window.addEventListener("keydown",h,!1);l=a},close:a}}();
wpd.busyNote=function(){var a,b=!1;return{show:function(){b||(null==a&&(a=document.createElement("div"),a.id="wait",a.innerHTML='<p align="center">'+wpd.gettext("processing")+"...</p>"),document.body.appendChild(a),b=!0)},close:function(){null!=a&&!0===b&&(document.body.removeChild(a),b=!1)}}}();
wpd.messagePopup=function(){var a;return{show:function(b,c,d){wpd.popup.show("messagePopup");document.getElementById("message-popup-heading").innerHTML=b;document.getElementById("message-popup-text").innerHTML=c;a=d},close:function(){wpd.popup.close("messagePopup");null!=a&&a()}}}();
wpd.okCancelPopup=function(){var a,b;return{show:function(c,d,e,f){wpd.popup.show("okCancelPopup");document.getElementById("ok-cancel-popup-heading").innerHTML=c;document.getElementById("ok-cancel-popup-text").innerHTML=d;a=e;b=f},ok:function(){wpd.popup.close("okCancelPopup");null!=a&&a()},cancel:function(){wpd.popup.close("okCancelPopup");null!=b&&b()}}}();wpd.unsupported=function(){wpd.messagePopup.show(wpd.gettext("unsupported"),wpd.gettext("unsupported-text"))};wpd=wpd||{};
wpd.sidebar=function(){function a(){for(var a=document.getElementsByClassName("sidebar"),c=0;c<a.length;c++)a[c].style.display="none"}return{show:function(b){a();b=document.getElementById(b);b.style.display="inline-block";b.style.height=parseInt(document.body.offsetHeight,10)-280+"px"},clear:a,resize:function(){for(var a=document.getElementsByClassName("sidebar"),c=0;c<a.length;c++)"inline-block"===a[c].style.display&&(a[c].style.height=parseInt(document.body.offsetHeight,10)-280+"px")}}}();
wpd=wpd||{};wpd.toolbar=function(){function a(){for(var a=document.getElementsByClassName("toolbar"),c=0;c<a.length;c++)a[c].style.visibility="hidden"}return{show:function(b){a();document.getElementById(b).style.visibility="visible"},clear:a}}();wpd=wpd||{};
wpd.transformationEquations=function(){return{show:function(){wpd.popup.show("axes-transformation-equations-window");var a=document.getElementById("axes-transformation-equation-list"),b="",c=wpd.tree.getActiveAxes(),d=c.getTransformationEquations();b+="<p><b>Axes Type</b>: ";c instanceof wpd.XYAxes?b+="XY</p>":c instanceof wpd.PolarAxes?b+="Polar</p>":c instanceof wpd.TernaryAxes?b+="Ternary</p>":c instanceof wpd.MapAxes?b+="Map</p>":c instanceof wpd.ImageAxes&&(b+="Image</p>");if(null!=d.pixelToData){b+=
"<p><b>Pixel to Data</b></p><ol>";for(c=0;c<d.pixelToData.length;c++)b+='<li><p class="footnote">'+d.pixelToData[c]+"</p></li>";b+="</ol>"}b+="<p>&nbsp;</p>";if(null!=d.dataToPixel){b+="<p><b>Data to Pixel</b></p><ol>";for(i=0;i<d.dataToPixel.length;i++)b+='<li><p class="footnote">'+d.dataToPixel[i]+"</p></li>";b+="</ol>"}a.innerHTML=b}}}();wpd=wpd||{};
wpd.TreeWidget=function(a){var b=this;this.$mainElem=a;this.treeData=null;this.$mainElem.addEventListener("click",function(a){return b._onclick(a)});this.$mainElem.addEventListener("keydown",function(a){return b._onkeydown(a)});this.$mainElem.addEventListener("dblclick",function(a){return b._ondblclick(a)});this.idmap=[];this.itemCount=0;this.selectedPath=null};
wpd.TreeWidget.prototype._renderFolder=function(a,b,c){if(null!=a){c=c?'<ul class="tree-list">':'<ul class="tree-list-root">';for(var d=0;d<a.length;d++){var e=a[d];this.itemCount++;if("string"===typeof e)c+='<li title="'+e+'">',c+='<span class="tree-item" id="tree-item-id-'+this.itemCount+'">'+e+"</span>",this.idmap[this.itemCount]=b+"/"+e;else if("object"===typeof e){c+="<li>";var f=Object.keys(e)[0];c+='<span class="tree-folder" id="tree-item-id-'+this.itemCount+'">'+f+"</span>";this.idmap[this.itemCount]=
b+"/"+f;c+=this._renderFolder(e[f],b+"/"+f,!0)}c+="</li>"}return c+"</ul>"}};wpd.TreeWidget.prototype.render=function(a){this.idmap=[];this.itemCount=0;this.treeData=a;this.$mainElem.innerHTML=this._renderFolder(this.treeData,"",!1);this.selectedPath=null};
wpd.TreeWidget.prototype._unselectAll=function(){var a=this.$mainElem.querySelectorAll(".tree-folder"),b=this.$mainElem.querySelectorAll(".tree-item");a.forEach(function(a){a.classList.remove("tree-selected")});b.forEach(function(a){a.classList.remove("tree-selected")});this.selectedPath=null};
wpd.TreeWidget.prototype.selectPath=function(a,b){var c=this.idmap.indexOf(a);0<=c&&(this._unselectAll(),this.selectedPath=a,c=document.getElementById("tree-item-id-"+c),c.classList.add("tree-selected"),null!=this.itemSelectionCallback&&this.itemSelectionCallback(c,a,b))};
wpd.TreeWidget.prototype._onclick=function(a){var b=a.target.classList.contains("tree-item"),c=a.target.classList.contains("tree-folder");if(b||c)this._unselectAll(),a.target.classList.add("tree-selected"),null!=this.itemSelectionCallback&&(b=parseInt(a.target.id.replace("tree-item-id-",""),10),isNaN(b)||(this.selectedPath=this.idmap[b],this.itemSelectionCallback(a.target,this.idmap[b],!1)))};
wpd.TreeWidget.prototype._onkeydown=function(a){("F2"===a.key||"r"===a.key.toLowerCase()&&a.metaKey)&&this.itemRenameCallback&&(this.itemRenameCallback(a.target,this.selectedPath,!1),a.preventDefault())};wpd.TreeWidget.prototype._ondblclick=function(a){this.itemRenameCallback&&(this.itemRenameCallback(a.target,this.selectedPath,!1),a.preventDefault(),a.stopPropagation())};wpd.TreeWidget.prototype.onItemSelection=function(a){this.itemSelectionCallback=a};
wpd.TreeWidget.prototype.onItemRename=function(a){this.itemRenameCallback=a};wpd.TreeWidget.prototype.getSelectedPath=function(){return this.selectedPath};
wpd.tree=function(){function a(){if(null!=g){var a=[],c=wpd.appData.getPlotData();a.push(wpd.gettext("image"));var e={};e[wpd.gettext("axes")]=c.getAxesNames();a.push(e);e=c.getDatasetNames();var d={};d[wpd.gettext("datasets")]=e;a.push(d);e=[];d=c.getMeasurementsByType(wpd.DistanceMeasurement);var f=c.getMeasurementsByType(wpd.AngleMeasurement);0<c.getMeasurementsByType(wpd.AreaMeasurement).length&&e.push(wpd.gettext("area"));0<f.length&&e.push(wpd.gettext("angle"));0<d.length&&e.push(wpd.gettext("distance"));
c={};c[wpd.gettext("measurements")]=e;a.push(c);g.render(a);b(null)}}function b(a){document.querySelectorAll(".tree-widget").forEach(function(b){b.style.display=b.id===a?"inline":"none"})}function c(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.sidebar.clear()}function d(a){a=a==wpd.measurementModes.distance;var b=wpd.appData.getPlotData(),c=a?b.getMeasurementsByType(wpd.DistanceMeasurement):b.getMeasurementsByType(wpd.AreaMeasurement);if(1==c.length){var e=c[0];a=a?document.getElementById("distance-item-axes-select"):
document.getElementById("area-item-axes-select");c=b.getAxesColl();b=b.getAxesForMeasurement(e);e="<option value='-1'>None</option>";for(var d=0;d<c.length;d++)if(c[d]instanceof wpd.ImageAxes||c[d]instanceof wpd.MapAxes)e+="<option value='"+d+"'>"+c[d].name+"</option>";a.innerHTML=e;a.value=null==b?"-1":c.indexOf(b);k=b}}function e(a,e,f){if(e==="/"+wpd.gettext("image"))c(),k=null,b("image-item-tree-widget"),wpd.sidebar.show("image-editing-sidebar"),wpd.appData.getUndoManager().updateUI();else if(e===
"/"+wpd.gettext("datasets"))c(),b("dataset-group-tree-widget"),k=null;else if(e==="/"+wpd.gettext("axes"))c(),b("axes-group-tree-widget"),k=null;else if(e==="/"+wpd.gettext("measurements"))c(),b("measurement-group-tree-widget"),k=null;else if(e==="/"+wpd.gettext("measurements")+"/"+wpd.gettext("distance"))f||wpd.measurement.start(wpd.measurementModes.distance),b("distance-item-tree-widget"),d(wpd.measurementModes.distance);else if(e==="/"+wpd.gettext("measurements")+"/"+wpd.gettext("angle"))f||wpd.measurement.start(wpd.measurementModes.angle),
b("angle-item-tree-widget"),k=null;else if(e==="/"+wpd.gettext("measurements")+"/"+wpd.gettext("area"))f||wpd.measurement.start(wpd.measurementModes.area),b("area-item-tree-widget"),d(wpd.measurementModes.area);else if(e.startsWith("/"+wpd.gettext("datasets")+"/")){if(a=wpd.appData.getPlotData(),e=a.getDatasetNames().indexOf(e.replace("/"+wpd.gettext("datasets")+"/","")),0<=e&&(f||c(),h=a.getDatasets()[e],f||wpd.acquireData.load()),b("dataset-item-tree-widget"),null!=h){e=wpd.appData.getPlotData();
f=e.getAxesNames();e=e.getAxesForDataset(h);a=document.getElementById("dataset-item-axes-select");for(var g="<option value='-1'>None</option>",l=0;l<f.length;l++)g+="<option value='"+l+"'>"+f[l]+"</option>";a.innerHTML=g;a.value=null==e?"-1":f.indexOf(e.name);k=e}}else e.startsWith("/"+wpd.gettext("axes")+"/")?(c(),b("axes-item-tree-widget"),e=e.replace("/"+wpd.gettext("axes")+"/",""),f=wpd.appData.getPlotData(),e=f.getAxesNames().indexOf(e),k=f.getAxesColl()[e],document.getElementById("tweak-axes-calibration-button").disabled=
k instanceof wpd.ImageAxes?!0:!1):(c(),b(null),k=null)}function f(a,b,c){b.startsWith("/"+wpd.gettext("datasets")+"/")?wpd.dataSeriesManagement.showRenameDataset():b.startsWith("/"+wpd.gettext("axes")+"/")&&wpd.alignAxes.showRenameAxes()}var g=null,h=null,k=null;window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(a,b){b=b||window;for(var c=0;c<this.length;c++)a.call(b,this[c],c,this)});return{init:function(){var b=document.getElementById("tree-container");g=new wpd.TreeWidget(b);
g.onItemSelection(e);g.onItemRename(f);a()},refresh:function(){a()},refreshPreservingSelection:function(b){if(null!=g){var c=g.getSelectedPath();a();g.selectPath(c,!b)}else a()},selectPath:function(a,b){g.selectPath(a,b)},addMeasurement:function(b){wpd.measurement.start(b);a();b===wpd.measurementModes.distance?wpd.tree.selectPath("/"+wpd.gettext("measurements")+"/"+wpd.gettext("distance"),!0):b===wpd.measurementModes.angle?wpd.tree.selectPath("/"+wpd.gettext("measurements")+"/"+wpd.gettext("angle"),
!0):b===wpd.measurementModes.area&&wpd.tree.selectPath("/"+wpd.gettext("measurements")+"/"+wpd.gettext("area"),!0)},getActiveDataset:function(){return h},getActiveAxes:function(){return k}}}();wpd=wpd||{};
wpd.webcamCapture=function(){function a(){void 0!=b&&b.stop();wpd.popup.close("webcamCapture")}var b;return{start:function(){if(null==(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia))wpd.messagePopup.show(wpd.gettext("webcam-capture"),wpd.gettext("webcam-capture-text"));else{wpd.popup.show("webcamCapture");var a=document.getElementById("webcamVideo");navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(c){b=c;a.src=window.URL.createObjectURL(c)},function(){})}},cancel:function(){a()},capture:function(){var b=document.createElement("canvas"),d=document.getElementById("webcamVideo"),e=b.getContext("2d");b.width=d.videoWidth;b.height=d.videoHeight;e.drawImage(d,0,0);var f=e.getImageData(0,0,b.width,b.height);a();wpd.graphicsWidget.runImageOp(function(){return{imageData:f,width:b.width,height:b.height}})}}}();wpd=wpd||{};
wpd.zoomView=function(){function a(){var a=document.getElementById("zoomCrossHair"),b=a.getContext("2d");a.width=a.width;b.strokeStyle="black"===h?"rgba(0,0,0,1)":"red"===h?"rgba(255,0,0,1)":"yellow"===h?"rgba(255,255,0,1)":"rgba(0,0,0,1)";b.beginPath();b.moveTo(125,0);b.lineTo(125,250);b.moveTo(0,125);b.lineTo(250,125);b.stroke()}var b,c,d,e,f,g,h="black";return{initZoom:function(){b=document.getElementById("zoomCanvas");c=b.getContext("2d");d=document.createElement("canvas");e=d.getContext("2d");
f=document.getElementById("mousePosition");g=5;a()},setZoomImage:function(a,f,h,m,p){d.width=m/g;d.height=p/g;e.putImageData(a,0,0);b.width=b.width;c.drawImage(d,f,h,m,p)},setCoords:function(a,b){var c=wpd.tree.getActiveAxes();f.innerHTML=null!=c?c.pixelToLiveString(a,b):a.toFixed(2)+", "+b.toFixed(2)},setZoomRatio:function(a){g=a},getZoomRatio:function(){return g},getSize:function(){return{width:250,height:250}},showSettingsWindow:function(){document.getElementById("zoom-magnification-value").value=
g;document.getElementById("zoom-crosshair-color-value").value=h;wpd.popup.show("zoom-settings-popup")},applySettings:function(){g=document.getElementById("zoom-magnification-value").value;h=document.getElementById("zoom-crosshair-color-value").value;a();wpd.popup.close("zoom-settings-popup")}}}();wpd=wpd||{};
wpd.AxesCornersTool=function(){return function(a,b){var c=0,d=!0;b?(c=a.maxPointCount,d=!1):(c=0,d=!0,wpd.graphicsWidget.resetData());this.onMouseClick=function(b,f,g){d?(c+=1,a.addPoint(g.x,g.y,0,0),a.unselectAll(),a.selectPoint(c-1),wpd.graphicsWidget.forceHandlerRepaint(),c===a.maxPointCount&&(d=!1,wpd.alignAxes.calibrationCompleted())):(a.unselectAll(),a.selectNearestPoint(g.x,g.y),wpd.graphicsWidget.forceHandlerRepaint());wpd.graphicsWidget.updateZoomOnEvent(b)};this.onKeyDown=function(b){if(0!==
a.getSelectedPoints().length){var c=a.getPoint(a.getSelectedPoints()[0]),e=c.px;c=c.py;var d=!0===b.shiftKey?5/wpd.graphicsWidget.getZoomRatio():.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(b.keyCode))c-=d;else if(wpd.keyCodes.isDown(b.keyCode))c+=d;else if(wpd.keyCodes.isLeft(b.keyCode))e-=d;else if(wpd.keyCodes.isRight(b.keyCode))e+=d;else return;a.changePointPx(a.getSelectedPoints()[0],e,c);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e,c);b.preventDefault();
b.stopPropagation()}}}}();wpd.AlignmentCornersRepainter=function(){return function(a){this.painterName="AlignmentCornersReptainer";this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();this.onRedraw()};this.onRedraw=function(){if(null!=a){var b;for(b=0;b<a.getCount();b++){var c=a.getPoint(b);c={x:c.px,y:c.py};var d=a.isPointSelected(b)?"rgba(0,200,0,1)":"rgba(200,0,0,1)";wpd.graphicsHelper.drawPoint(c,d,a.labels[b],a.labelPositions[b])}}}}}();wpd=wpd||{};
wpd.ColorPickerTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts();this.onMouseClick=function(b,c,d){var e=a.oriImageCtx.getImageData(d.x,d.y,1,1);b=e.data[0];c=e.data[1];d=e.data[2];0===e.data[3]&&(d=c=b=255);this.onComplete([b,c,d])};this.onComplete=function(a){}}}();
wpd.ColorFilterRepainter=function(){return function(){this.painterName="colorFilterRepainter";this.onRedraw=function(){var a=wpd.appData.getPlotData().getAutoDetector();wpd.colorSelectionWidget.paintFilteredColor(a.binaryData,a.mask)}}}();wpd=wpd||{};
wpd.graphicsHelper=function(){return{drawPoint:function(a,b,c,d){var e=wpd.graphicsWidget.screenPx(a.x,a.y),f=wpd.graphicsWidget.getAllContexts(),g=wpd.graphicsWidget.getImageSize().height;if(null!=c){f.dataCtx.font="15px sans-serif";var h=f.dataCtx.measureText(c).width;f.dataCtx.fillStyle="rgba(255, 255, 255, 0.7)";f.oriDataCtx.font="15px sans-serif";f.oriDataCtx.fillStyle=b;switch(d){case "N":case "n":f.dataCtx.fillRect(e.x-13,e.y-24,h+5,35);f.dataCtx.fillStyle=b;f.dataCtx.fillText(c,e.x-10,e.y-
7);f.oriDataCtx.fillText(c,a.x-10,a.y-7);break;case "E":case "e":f.dataCtx.fillRect(e.x-7,e.y-16,h+17,26);f.dataCtx.fillStyle=b;f.dataCtx.fillText(c,e.x+7,e.y+5);f.oriDataCtx.fillText(c,a.x+7,a.y+5);break;case "W":case "w":f.dataCtx.fillRect(e.x-h-10,e.y-16,h+17,26);f.dataCtx.fillStyle=b;f.dataCtx.fillText(c,e.x-h-7,e.y+5);f.oriDataCtx.fillText(c,a.x-h-7,a.y+5);break;default:f.dataCtx.fillRect(e.x-13,e.y-8,h+5,35),f.dataCtx.fillStyle=b,f.dataCtx.fillText(c,e.x-10,e.y+18),f.oriDataCtx.fillText(c,a.x-
10,a.y+18)}}f.dataCtx.beginPath();f.dataCtx.fillStyle=b;f.dataCtx.strokeStyle="rgb(255, 255, 255)";f.dataCtx.arc(e.x,e.y,4,0,2*Math.PI,!0);f.dataCtx.fill();f.dataCtx.stroke();f.oriDataCtx.beginPath();f.oriDataCtx.fillStyle=b;f.oriDataCtx.strokeStyle="rgb(255, 255, 255)";f.oriDataCtx.arc(a.x,a.y,1500<g?4:2,0,2*Math.PI,!0);f.oriDataCtx.fill();f.oriDataCtx.stroke()}}}();wpd=wpd||{};
wpd.GridColorFilterRepainter=function(){return function(){this.painterName="gridColorFilterRepainter";this.onRedraw=function(){var a=wpd.appData.getPlotData().getGridDetectionData();wpd.colorSelectionWidget.paintFilteredColor(a.binaryData,a.gridMask.pixels)}}}();
wpd.GridBoxTool=function(){return function(){var a=!1,b,c,d=wpd.graphicsWidget.getAllContexts(),e,f,g=function(){wpd.graphicsWidget.resetHover();d.hoverCtx.strokeStyle="rgb(0,0,0)";d.hoverCtx.strokeRect(c.x,c.y,f.x-c.x,f.y-c.y)},h=function(f,g,h){!1!==a&&(clearTimeout(e),a=!1,wpd.graphicsWidget.resetHover(),d.dataCtx.fillStyle="rgba(255,255,0,0.8)",d.dataCtx.fillRect(c.x,c.y,g.x-c.x,g.y-c.y),d.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",d.oriDataCtx.fillRect(b.x,b.y,h.x-b.x,h.y-b.y))},k=null,l=null;
this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter);document.getElementById("grid-mask-box").classList.add("pressed-button");document.getElementById("grid-mask-view").classList.add("pressed-button")};this.onMouseDown=function(e,d,f){!0!==a&&(a=!0,b=f,c=d)};this.onMouseMove=function(b,c,d){!1!==a&&(f=c,clearTimeout(e),e=setTimeout(g,2))};this.onMouseOut=function(b,c,d){!0===a&&(clearTimeout(e),k=c,l=d)};this.onDocumentMouseUp=function(a,b,c){null!=k&&null!=l?h(a,k,l):
h(a,b,c);l=k=null};this.onMouseUp=function(a,b,c){h(a,b,c)};this.onRemove=function(){document.getElementById("grid-mask-box").classList.remove("pressed-button");document.getElementById("grid-mask-view").classList.remove("pressed-button");wpd.gridDetection.grabMask()}}}();
wpd.GridViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter);document.getElementById("grid-mask-view").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("grid-mask-view").classList.remove("pressed-button");wpd.gridDetection.grabMask()}}}();
wpd.GridMaskPainter=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData().getGridDetectionData(),c=function(){if(null!=b.gridMask.pixels&&0!==b.gridMask.pixels.size){var c=wpd.graphicsWidget.getImageSize();c=a.oriDataCtx.getImageData(0,0,c.width,c.height);for(var e=$jscomp.makeIterator(b.gridMask.pixels),f=e.next();!f.done;f=e.next())f=f.value,c.data[4*f]=255,c.data[4*f+1]=255,c.data[4*f+2]=0,c.data[4*f+3]=200;a.oriDataCtx.putImageData(c,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}};
this.painterName="gridMaskPainter";this.onRedraw=function(){wpd.gridDetection.grabMask();c()};this.onAttach=function(){wpd.graphicsWidget.resetData();c()}}}();wpd=wpd||{};wpd.CropTool=function(){this._isResizing=this._hasCropBox=this._isDrawing=!1;this._hotspotCoords=this._imagePos=this._screenPos=this._moveTimer=this._topScreenCorner=this._topImageCorner=null;this._resizingHotspot="";this._resizeStartCoords={x:0,y:0};this._ctx=wpd.graphicsWidget.getAllContexts()};
wpd.CropTool.prototype.onAttach=function(){document.getElementById("image-editing-crop").classList.add("pressed-button")};wpd.CropTool.prototype.onRemove=function(){wpd.graphicsWidget.resetHover();document.getElementById("image-editing-crop").classList.remove("pressed-button")};
wpd.CropTool.prototype.onMouseDown=function(a,b,c){this._hasCropBox?(a=this._getHotspot(b),null!=a&&(this._isResizing=!0,this._resizeStartCoords={x:b.x,y:b.y},this._resizingHotspot=a)):(this._isDrawing=!0,this._topImageCorner=c,this._topScreenCorner=b)};
wpd.CropTool.prototype.onMouseMove=function(a,b,c){var d=this;if(this._isDrawing)this._screenPos=b,this._imagePos=c,clearTimeout(this._moveTimer),this._moveTimer=setTimeout(function(){d._drawCropBox()},2);else if(this._hasCropBox){c=this._isResizing?this._resizingHotspot:this._getHotspot(b);if(null!=c){var e="crosshair";"n"===c||"s"===c?e="ns-resize":"e"==c||"w"==c?e="ew-resize":"nw"==c||"se"==c?e="nwse-resize":"ne"==c||"sw"==c?e="nesw-resize":"c"==c&&(e="move");a.target.style.cursor=e}else a.target.style.cursor=
"crosshair";this._isResizing&&(a=b.x-this._resizeStartCoords.x,c=b.y-this._resizeStartCoords.y,"n"==this._resizingHotspot?this._topScreenCorner.y+=c:"s"==this._resizingHotspot?this._screenPos.y+=c:"w"==this._resizingHotspot?this._topScreenCorner.x+=a:"e"==this._resizingHotspot?this._screenPos.x+=a:"nw"==this._resizingHotspot?(this._topScreenCorner.y+=c,this._topScreenCorner.x+=a):"ne"==this._resizingHotspot?(this._topScreenCorner.y+=c,this._screenPos.x+=a):"sw"==this._resizingHotspot?(this._screenPos.y+=
c,this._topScreenCorner.x+=a):"se"==this._resizingHotspot?(this._screenPos.y+=c,this._screenPos.x+=a):"c"==this._resizingHotspot&&(this._topScreenCorner.x+=a,this._topScreenCorner.y+=c,this._screenPos.x+=a,this._screenPos.y+=c),clearTimeout(this._moveTimer),this._moveTimer=setTimeout(function(){d._drawCropBox()},2),this._resizeStartCoords={x:b.x,y:b.y})}};
wpd.CropTool.prototype._drawCropBox=function(){wpd.graphicsWidget.resetHover();var a=this._ctx.hoverCtx;a.strokeStyle="rgb(0,0,0)";a.strokeRect(this._topScreenCorner.x,this._topScreenCorner.y,this._screenPos.x-this._topScreenCorner.x,this._screenPos.y-this._topScreenCorner.y);this._hotspotCoords=this._getHotspotCoords();a.fillStyle="rgb(255,0,0)";a.strokeStyle="rgb(255,255,255)";for(var b=$jscomp.makeIterator(this._hotspotCoords),c=b.next();!c.done;c=b.next())c=c.value,a.beginPath(),a.arc(c.x,c.y,
4,0,2*Math.PI,!0),a.fill(),a.stroke()};wpd.CropTool.prototype.onMouseUp=function(a,b,c){this._finalizeDrawing()};wpd.CropTool.prototype._finalizeDrawing=function(){clearTimeout(this._moveTimer);if(this._isDrawing||this._isResizing)this._isResizing=this._isDrawing=!1,this._hasCropBox=!0,this._drawCropBox()};
wpd.CropTool.prototype._getHotspotCoords=function(){return[{x:this._topScreenCorner.x,y:this._topScreenCorner.y},{x:this._screenPos.x,y:this._topScreenCorner.y},{x:this._screenPos.x,y:this._screenPos.y},{x:this._topScreenCorner.x,y:this._screenPos.y},{x:(this._topScreenCorner.x+this._screenPos.x)/2,y:this._topScreenCorner.y},{x:this._screenPos.x,y:(this._topScreenCorner.y+this._screenPos.y)/2},{x:(this._topScreenCorner.x+this._screenPos.x)/2,y:this._screenPos.y},{x:this._topScreenCorner.x,y:(this._topScreenCorner.y+
this._screenPos.y)/2},{x:(this._topScreenCorner.x+this._screenPos.x)/2,y:(this._topScreenCorner.y+this._screenPos.y)/2}]};wpd.CropTool.prototype._getHotspot=function(a){for(var b="nw ne se sw n e s w c".split(" "),c=this._hotspotCoords,d=0;d<c.length;d++){var e=c[d];if(64>(e.x-a.x)*(e.x-a.x)+(e.y-a.y)*(e.y-a.y))return b[d]}return null};wpd.CropTool.prototype.onMouseOut=function(){this._finalizeDrawing()};wpd.CropTool.prototype.onDocumentMouseUp=function(){this._finalizeDrawing()};
wpd.CropTool.prototype.onKeyDown=function(a){var b=wpd.keyCodes.isEsc(a.keyCode),c=wpd.keyCodes.isEnter(a.keyCode);if(b||c)this._isDrawing=!1,wpd.graphicsWidget.resetHover();b&&(this._hasCropBox=!1);c&&this._hasCropBox&&(b=new wpd.CropImageAction(this._topImageCorner.x,this._topImageCorner.y,this._imagePos.x,this._imagePos.y),wpd.appData.getUndoManager().insertAction(b),b.execute());a.preventDefault()};
wpd.CropTool.prototype.onRedraw=function(){this._hasCropBox&&(this._topScreenCorner=wpd.graphicsWidget.screenPx(this._topImageCorner.x,this._topImageCorner.y),this._screenPos=wpd.graphicsWidget.screenPx(this._imagePos.x,this._imagePos.y),this._drawCropBox())};wpd=wpd||{};
wpd.imageOps=function(){function a(a,b,e){var c,d,h;for(c=0;c<e;c++)for(d=0;d<b/2;d++){var k=4*(c*b+d);var l=4*((c+1)*b-(d+1));for(h=0;4>h;h++){var n=a.data[k+h];a.data[k+h]=a.data[l+h];a.data[l+h]=n}}return{imageData:a,width:b,height:e}}function b(a,b,e){var c,d,h;for(c=0;c<e/2;c++)for(d=0;d<b;d++){var k=4*(c*b+d);var l=4*((e-(c+2))*b+d);for(h=0;4>h;h++){var n=a.data[k+h];a.data[k+h]=a.data[l+h];a.data[l+h]=n}}return{imageData:a,width:b,height:e}}return{hflip:function(){wpd.graphicsWidget.runImageOp(a)},
vflip:function(){wpd.graphicsWidget.runImageOp(b)}}}();wpd=wpd||{};wpd.keyCodes={isUp:function(a){return 38===a},isDown:function(a){return 40===a},isLeft:function(a){return 37===a},isRight:function(a){return 39===a},isTab:function(a){return 9===a},isDel:function(a){return 46===a},isBackspace:function(a){return 8===a},isAlphabet:function(a,b){return 90<a||65>a?!1:String.fromCharCode(a).toLowerCase()===b},isEnter:function(a){return 13===a},isEsc:function(a){return 27===a}};wpd=wpd||{};
wpd.ManualSelectionTool=function(){return function(a,b){this.onAttach=function(){document.getElementById("manual-select-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(a,b))};this.onMouseClick=function(c,d,e){a.dataPointsHaveLabels?(d=b.getMetadataKeys(),null!=d&&"Label"===d[0]||b.setMetadataKeys(["Label"]),d=a.dataPointsLabelPrefix+b.getCount(),b.addPixel(e.x,e.y,[d]),wpd.graphicsHelper.drawPoint(e,"rgb(200,0,0)",d)):(b.addPixel(e.x,e.y),wpd.graphicsHelper.drawPoint(e,
"rgb(200,0,0)"));wpd.graphicsWidget.updateZoomOnEvent(c);wpd.dataPointCounter.setCount(b.getCount());a.dataPointsHaveLabels&&c.shiftKey&&wpd.dataPointLabelEditor.show(b,b.getCount()-1,this)};this.onRemove=function(){document.getElementById("manual-select-button").classList.remove("pressed-button")};this.onKeyDown=function(a){var c=b.getCount()-1,e=b.getPixel(c),f=.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))e.y-=f;else if(wpd.keyCodes.isDown(a.keyCode))e.y+=f;else if(wpd.keyCodes.isLeft(a.keyCode))e.x-=
f;else if(wpd.keyCodes.isRight(a.keyCode))e.x+=f;else{wpd.acquireData.isToolSwitchKey(a.keyCode)&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase());return}b.setPixelAt(c,e.x,e.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e.x,e.y);a.preventDefault()}}}();
wpd.DeleteDataPointTool=function(){return function(a,b){wpd.graphicsWidget.getAllContexts();this.onAttach=function(){document.getElementById("delete-point-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(a,b))};this.onMouseClick=function(a,d,e){b.removeNearestPixel(e.x,e.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a);wpd.dataPointCounter.setCount(b.getCount())};this.onKeyDown=function(a){wpd.acquireData.isToolSwitchKey(a.keyCode)&&
wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase())};this.onRemove=function(){document.getElementById("delete-point-button").classList.remove("pressed-button")}}}();
wpd.DataPointsRepainter=function(){return function(a,b){var c=function(){var c=b.getMetadataKeys();var e=!1;if(null!=a)for(a.dataPointsHaveLabels&&null!=c&&"Label"===c[0]&&(e=!0),c=0;c<b.getCount();c++){var f=b.getPixel(c);var g=(g=0<=b.getSelectedPixels().indexOf(c))?"rgb(0,200,0)":"rgb(200,0,0)";if(e){var h=f.metadata[0];null==h&&(h=a.dataPointsLabelPrefix+c);wpd.graphicsHelper.drawPoint(f,g,h)}else wpd.graphicsHelper.drawPoint(f,g)}};this.painterName="dataPointsRepainter";this.onAttach=function(){wpd.graphicsWidget.resetData();
c()};this.onRedraw=function(){c()};this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();c()}}}();
wpd.AdjustDataPointTool=function(){return function(a,b){this.onAttach=function(){document.getElementById("manual-adjust-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(a,b));wpd.toolbar.show("adjustDataPointsToolbar")};this.onRemove=function(){b.unselectAll();wpd.graphicsWidget.forceHandlerRepaint();document.getElementById("manual-adjust-button").classList.remove("pressed-button");wpd.toolbar.clear()};this.onMouseClick=function(a,d,e){b.unselectAll();
b.selectNearestPixel(e.x,e.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a)};this.onKeyDown=function(c){if(wpd.acquireData.isToolSwitchKey(c.keyCode))wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(c.keyCode).toLowerCase());else{var d=b.getSelectedPixels()[0];if(null!=d){var e=b.getPixel(d),f=e.x;e=e.y;var g=!0===c.shiftKey?5/wpd.graphicsWidget.getZoomRatio():.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(c.keyCode))e-=g;else if(wpd.keyCodes.isDown(c.keyCode))e+=
g;else if(wpd.keyCodes.isLeft(c.keyCode))f-=g;else if(wpd.keyCodes.isRight(c.keyCode))f+=g;else if(wpd.keyCodes.isAlphabet(c.keyCode,"q"))b.selectPreviousPixel(),d=b.getSelectedPixels()[0],e=b.getPixel(d),f=e.x,e=e.y;else if(wpd.keyCodes.isAlphabet(c.keyCode,"w"))b.selectNextPixel(),d=b.getSelectedPixels()[0],e=b.getPixel(d),f=e.x,e=e.y;else if(wpd.keyCodes.isAlphabet(c.keyCode,"e")){if(a.dataPointsHaveLabels){d=b.getSelectedPixels()[0];c.preventDefault();c.stopPropagation();wpd.dataPointLabelEditor.show(b,
d,this);return}}else{if(wpd.keyCodes.isDel(c.keyCode)||wpd.keyCodes.isBackspace(c.keyCode))b.removePixelAtIndex(d),b.unselectAll(),0<=b.findNearestPixel(f,e)&&(b.selectNearestPixel(f,e),d=b.getSelectedPixels()[0],e=b.getPixel(d),f=e.x,e=e.y),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomToImagePosn(f,e),wpd.dataPointCounter.setCount(),c.preventDefault(),c.stopPropagation();return}b.setPixelAt(d,f,e);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f,
e);c.preventDefault();c.stopPropagation()}}}}}();
wpd.EditLabelsTool=function(a,b){this.onAttach=function(){document.getElementById("edit-data-labels").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(a,b))};this.onRemove=function(){document.getElementById("edit-data-labels").classList.remove("pressed-button");b.unselectAll()};this.onMouseClick=function(a,d,e){b.unselectAll();d=b.selectNearestPixel(e.x,e.y);0<=d&&(wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomOnEvent(a),wpd.dataPointLabelEditor.show(b,
d,this))};this.onKeyDown=function(a){wpd.acquireData.isToolSwitchKey(a.keyCode)&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase())}};wpd.dataPointCounter={setCount:function(a){for(var b=document.getElementsByClassName("data-point-counter"),c=0;c<b.length;c++)b[c].innerHTML=a}};wpd=wpd||{};
wpd.BoxMaskTool=function(){return function(){var a=!1,b,c,d=wpd.graphicsWidget.getAllContexts(),e,f,g=function(){wpd.graphicsWidget.resetHover();d.hoverCtx.strokeStyle="rgb(0,0,0)";d.hoverCtx.strokeRect(c.x,c.y,f.x-c.x,f.y-c.y)},h=function(f,g,h){!1!==a&&(clearTimeout(e),a=!1,wpd.graphicsWidget.resetHover(),d.dataCtx.fillStyle="rgba(255,255,0,1)",d.dataCtx.fillRect(c.x,c.y,g.x-c.x,g.y-c.y),d.oriDataCtx.fillStyle="rgba(255,255,0,1)",d.oriDataCtx.fillRect(b.x,b.y,h.x-b.x,h.y-b.y))},k=null,l=null;this.onAttach=
function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("box-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button")};this.onMouseDown=function(e,d,f){!0!==a&&(a=!0,b=f,c=d)};this.onMouseMove=function(b,c,d){!1!==a&&(f=c,clearTimeout(e),e=setTimeout(g,2))};this.onMouseOut=function(b,c,d){!0===a&&(clearTimeout(e),k=c,l=d)};this.onDocumentMouseUp=function(a,b,c){null!=k&&null!=l?h(a,k,l):h(a,b,c);l=k=null};this.onMouseUp=
function(a,b,c){h(a,b,c)};this.onRemove=function(){document.getElementById("box-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.PenMaskTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=!1,c,d,e,f=function(){a.dataCtx.strokeStyle="rgba(255,255,0,1)";a.dataCtx.lineTo(d.x,d.y);a.dataCtx.stroke();a.oriDataCtx.strokeStyle="rgba(255,255,0,1)";a.oriDataCtx.lineTo(e.x,e.y);a.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("pen-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button");
document.getElementById("mask-paint-container").style.display="block"};this.onMouseDown=function(c,e,d){!0!==b&&(c=parseInt(document.getElementById("paintThickness").value,10),b=!0,a.dataCtx.strokeStyle="rgba(255,255,0,1)",a.dataCtx.lineWidth=c*wpd.graphicsWidget.getZoomRatio(),a.dataCtx.beginPath(),a.dataCtx.moveTo(e.x,e.y),a.oriDataCtx.strokeStyle="rgba(255,255,0,1)",a.oriDataCtx.lineWidth=c,a.oriDataCtx.beginPath(),a.oriDataCtx.moveTo(d.x,d.y))};this.onMouseMove=function(a,h,k){!1!==b&&(d=h,e=
k,clearTimeout(c),c=setTimeout(f,2))};this.onMouseUp=function(e,d,f){clearTimeout(c);a.dataCtx.closePath();a.dataCtx.lineWidth=1;a.oriDataCtx.closePath();a.oriDataCtx.lineWidth=1;b=!1};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onRemove=function(){document.getElementById("pen-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");document.getElementById("mask-paint-container").style.display="none";wpd.dataMask.grabMask();
wpd.toolbar.clear()}}}();
wpd.EraseMaskTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=!1,c,d,e,f=function(){a.dataCtx.globalCompositeOperation="destination-out";a.oriDataCtx.globalCompositeOperation="destination-out";a.dataCtx.strokeStyle="rgba(255,255,0,1)";a.dataCtx.lineTo(d.x,d.y);a.dataCtx.stroke();a.oriDataCtx.strokeStyle="rgba(255,255,0,1)";a.oriDataCtx.lineTo(e.x,e.y);a.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("erase-mask").classList.add("pressed-button");
document.getElementById("view-mask").classList.add("pressed-button");document.getElementById("mask-erase-container").style.display="block"};this.onMouseDown=function(c,e,d){!0!==b&&(c=parseInt(document.getElementById("eraseThickness").value,10),b=!0,a.dataCtx.globalCompositeOperation="destination-out",a.oriDataCtx.globalCompositeOperation="destination-out",a.dataCtx.strokeStyle="rgba(0,0,0,1)",a.dataCtx.lineWidth=c*wpd.graphicsWidget.getZoomRatio(),a.dataCtx.beginPath(),a.dataCtx.moveTo(e.x,e.y),
a.oriDataCtx.strokeStyle="rgba(0,0,0,1)",a.oriDataCtx.lineWidth=c,a.oriDataCtx.beginPath(),a.oriDataCtx.moveTo(d.x,d.y))};this.onMouseMove=function(a,h,k){!1!==b&&(d=h,e=k,clearTimeout(c),c=setTimeout(f,2))};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onMouseUp=function(e,d,f){clearTimeout(c);a.dataCtx.closePath();a.dataCtx.lineWidth=1;a.oriDataCtx.closePath();a.oriDataCtx.lineWidth=1;a.dataCtx.globalCompositeOperation="source-over";a.oriDataCtx.globalCompositeOperation="source-over";
b=!1};this.onRemove=function(){document.getElementById("erase-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");document.getElementById("mask-erase-container").style.display="none";wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();
wpd.ViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("view-mask").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.MaskPainter=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.tree.getActiveDataset(),c=wpd.appData.getPlotData().getAutoDetectionDataForDataset(b),d=function(){if(null!=c.mask&&0!==c.mask.size){var b=wpd.graphicsWidget.getImageSize();b=a.oriDataCtx.getImageData(0,0,b.width,b.height);for(var d=$jscomp.makeIterator(c.mask),g=d.next();!g.done;g=d.next())g=g.value,b.data[4*g]=255,b.data[4*g+1]=255,b.data[4*g+2]=0,b.data[4*g+3]=255;a.oriDataCtx.putImageData(b,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}};
this.painterName="dataMaskPainter";this.onRedraw=function(){wpd.dataMask.grabMask();d()};this.onAttach=function(){wpd.graphicsWidget.resetData();d()}}}();wpd=wpd||{};
wpd.AddMeasurementTool=function(){return function(a){var b=wpd.graphicsWidget.getAllContexts(),c=0,d=!0,e=[];this.onAttach=function(){document.getElementById(a.addButtonId).classList.add("pressed-button");0>a.connectivity&&(document.getElementById("add-polygon-info").style.display="block")};this.onRemove=function(){document.getElementById(a.addButtonId).classList.remove("pressed-button");0>a.connectivity&&(document.getElementById("add-polygon-info").style.display="none")};this.onKeyDown=function(b){wpd.keyCodes.isAlphabet(b.keyCode,
"a")?(wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(a))):wpd.keyCodes.isAlphabet(b.keyCode,"d")?(wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(a))):(wpd.keyCodes.isEnter(b.keyCode)||wpd.keyCodes.isEsc(b.keyCode))&&!0===d&&0>a.connectivity&&(d=!1,a.getData().addConnection(e),wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(a)))};this.onMouseClick=
function(f,g,h){if(d){wpd.graphicsWidget.resetHover();e[2*c]=h.x;e[2*c+1]=h.y;c+=1;if(c===a.connectivity){d=!1;a.getData().addConnection(e);wpd.graphicsWidget.resetHover();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(a));return}if(1<c){var k=wpd.graphicsWidget.screenPx(e[2*(c-2)],e[2*(c-2)+1]);b.dataCtx.beginPath();b.dataCtx.strokeStyle="rgb(0,0,10)";b.dataCtx.moveTo(k.x,k.y);b.dataCtx.lineTo(g.x,g.y);b.dataCtx.stroke();b.oriDataCtx.beginPath();
b.oriDataCtx.strokeStyle="rgb(0,0,10)";b.oriDataCtx.moveTo(e[2*(c-2)],e[2*(c-2)+1]);b.oriDataCtx.lineTo(h.x,h.y);b.oriDataCtx.stroke()}b.dataCtx.beginPath();b.dataCtx.fillStyle="rgb(200, 0, 0)";b.dataCtx.arc(g.x,g.y,3,0,2*Math.PI,!0);b.dataCtx.fill();b.oriDataCtx.beginPath();b.oriDataCtx.fillStyle="rgb(200,0,0)";b.oriDataCtx.arc(h.x,h.y,3,0,2*Math.PI,!0);b.oriDataCtx.fill()}wpd.graphicsWidget.updateZoomOnEvent(f)};this.onMouseMove=function(a,g,h){d&&1<=c&&(wpd.graphicsWidget.resetHover(),a=wpd.graphicsWidget.screenPx(e[2*
(c-1)],e[2*(c-1)+1]),b.hoverCtx.beginPath(),b.hoverCtx.strokeStyle="rgb(0,0,0)",b.hoverCtx.moveTo(a.x,a.y),b.hoverCtx.lineTo(g.x,g.y),b.hoverCtx.stroke())}}}();
wpd.DeleteMeasurementTool=function(){return function(a){wpd.graphicsWidget.getAllContexts();this.onAttach=function(){document.getElementById(a.deleteButtonId).classList.add("pressed-button")};this.onRemove=function(){document.getElementById(a.deleteButtonId).classList.remove("pressed-button")};this.onKeyDown=function(b){wpd.keyCodes.isAlphabet(b.keyCode,"a")?wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(a)):wpd.keyCodes.isAlphabet(b.keyCode,"d")&&wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(a))};
this.onMouseClick=function(b,c,d){a.getData().deleteNearestConnection(d.x,d.y);wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(a));wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(b)}}}();
wpd.AdjustMeasurementTool=function(){return function(a){this.onAttach=function(){};this.onMouseClick=function(b,c,d){a.getData().selectNearestPoint(d.x,d.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(b)};this.onKeyDown=function(b){if(wpd.keyCodes.isAlphabet(b.keyCode,"a"))wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(a));else if(wpd.keyCodes.isAlphabet(b.keyCode,"d"))wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(a));else{var c=a.getData(),d=c.getSelectedConnectionAndPoint();
if(0<=d.connectionIndex&&0<=d.pointIndex){var e=!0===b.shiftKey?5/wpd.graphicsWidget.getZoomRatio():.5/wpd.graphicsWidget.getZoomRatio(),f=c.getPointAt(d.connectionIndex,d.pointIndex);if(wpd.keyCodes.isUp(b.keyCode))f.y-=e;else if(wpd.keyCodes.isDown(b.keyCode))f.y+=e;else if(wpd.keyCodes.isLeft(b.keyCode))f.x-=e;else if(wpd.keyCodes.isRight(b.keyCode))f.x+=e;else return;c.setPointAt(d.connectionIndex,d.pointIndex,f.x,f.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f.x,
f.y);b.preventDefault();b.stopPropagation()}}}}}();
wpd.MeasurementRepainter=function(){return function(a){var b=wpd.graphicsWidget.getAllContexts(),c=function(a,c,e,d,l,n,m,p){b.dataCtx.beginPath();b.dataCtx.strokeStyle="rgb(0,0,10)";b.dataCtx.moveTo(a,c);b.dataCtx.lineTo(e,d);b.dataCtx.stroke();b.oriDataCtx.beginPath();b.oriDataCtx.strokeStyle="rgb(0,0,10)";b.oriDataCtx.moveTo(l,n);b.oriDataCtx.lineTo(m,p);b.oriDataCtx.stroke()},d=function(a,c,e,d,l){b.dataCtx.beginPath();b.dataCtx.fillStyle=l?"rgb(0, 200, 0)":"rgb(200, 0, 0)";b.dataCtx.arc(a,c,
3,0,2*Math.PI,!0);b.dataCtx.fill();b.oriDataCtx.beginPath();b.oriDataCtx.fillStyle=l?"rgb(0,200,0)":"rgb(200,0,0)";b.oriDataCtx.arc(e,d,3,0,2*Math.PI,!0);b.oriDataCtx.fill()},e=function(a,c,e,d,l){a=parseInt(a,10);c=parseInt(c,10);e=parseInt(e,10);d=parseInt(d,10);b.dataCtx.font="14px sans-serif";var f=b.dataCtx.measureText(l).width;b.dataCtx.fillStyle="rgba(255, 255, 255, 0.7)";b.dataCtx.fillRect(a-5,c-15,f+10,25);b.dataCtx.fillStyle="rgb(200, 0, 0)";b.dataCtx.fillText(l,a,c);b.oriDataCtx.font="14px sans-serif";
f=b.oriDataCtx.measureText(l).width;b.oriDataCtx.fillStyle="rgba(255, 255, 255, 0.7)";b.oriDataCtx.fillRect(e-5,d-15,f+10,25);b.oriDataCtx.fillStyle="rgb(200, 0, 0)";b.oriDataCtx.fillText(l,e,d)};this.painterName="measurementRepainter-"+a.name;this.onAttach=function(){};this.onRedraw=function(){if(a.name===wpd.measurementModes.distance.name){var f=a.getData(),g=f.connectionCount(),h,k=a.getAxes();for(h=0;h<g;h++){var l=f.getConnectionAt(h);var n=l[0];var m=l[1];var p=l[2];l=l[3];var q=f.isPointSelected(h,
0);var t=f.isPointSelected(h,1);var r=!0===wpd.appData.isAligned()&&k instanceof wpd.MapAxes?"Dist"+h.toString()+": "+k.pixelToDataDistance(f.getDistance(h)).toFixed(2)+" "+k.getUnits():"Dist"+h.toString()+": "+f.getDistance(h).toFixed(2)+" px";var x=wpd.graphicsWidget.screenPx(n,m);var y=wpd.graphicsWidget.screenPx(p,l);c(x.x,x.y,y.x,y.y,n,m,p,l);d(x.x,x.y,n,m,q);d(y.x,y.y,p,l,t);e(.5*(x.x+y.x),.5*(x.y+y.y),.5*(n+p),.5*(m+l),r)}}else if(a.name===wpd.measurementModes.angle.name)for(f=a.getData(),
g=f.connectionCount(),h=0;h<g;h++){p=f.getConnectionAt(h);y=p[0];r=p[1];n=p[2];m=p[3];q=p[4];t=p[5];var B=f.isPointSelected(h,0);var w=f.isPointSelected(h,1);var v=f.isPointSelected(h,2);k="Theta"+h.toString()+": "+f.getAngle(h).toFixed(2)+"\u00b0";x=Math.atan2(r-m,y-n);l=Math.atan2(t-m,q-n);var z=wpd.graphicsWidget.screenPx(y,r);p=wpd.graphicsWidget.screenPx(n,m);var u=wpd.graphicsWidget.screenPx(q,t);c(z.x,z.y,p.x,p.y,y,r,n,m);c(p.x,p.y,u.x,u.y,n,m,q,t);d(z.x,z.y,y,r,B);d(p.x,p.y,n,m,w);d(u.x,u.y,
q,t,v);y=p.x;r=p.y;q=n;t=m;b.dataCtx.beginPath();b.dataCtx.strokeStyle="rgb(0,0,10)";b.dataCtx.arc(y,r,15,x,l,!0);b.dataCtx.stroke();b.oriDataCtx.beginPath();b.oriDataCtx.strokeStyle="rgb(0,0,10)";b.oriDataCtx.arc(q,t,15,x,l,!0);b.oriDataCtx.stroke();e(p.x+10,p.y+15,n+10,m+15,k)}else if(a.name===wpd.measurementModes.area.name)for(f=a.getData(),g=f.connectionCount(),h=a.getAxes(),n=0;n<g;n++){k=f.getConnectionAt(n);t=q=p=m=0;z={x:0,y:0};for(l=0;l<k.length;l+=2)x=k[l],y=k[l+1],r=wpd.graphicsWidget.screenPx(x,
y),2<=l&&c(z.x,z.y,r.x,r.y,q,t,x,y),l==k.length-2&&(q=k[0],t=k[1],z=wpd.graphicsWidget.screenPx(q,t),c(z.x,z.y,r.x,r.y,q,t,x,y)),q=x,t=y,z=r;for(l=0;l<k.length;l+=2)x=k[l],y=k[l+1],r=wpd.graphicsWidget.screenPx(x,y),q=f.isPointSelected(n,l/2),d(r.x,r.y,x,y,q),m+=x,p+=y;m/=k.length/2;p/=k.length/2;k=wpd.graphicsWidget.screenPx(m,p);!0===wpd.appData.isAligned()&&h instanceof wpd.MapAxes?(l="Area"+n+": "+h.pixelToDataArea(f.getArea(n)).toFixed(2)+" "+h.getUnits()+"^2",x="Perimeter"+n+": "+h.pixelToDataDistance(f.getPerimeter(n)).toFixed(2)+
" "+h.getUnits()):(l="Area"+n+": "+f.getArea(n).toFixed(2)+" px^2",x="Perimeter"+n+": "+f.getPerimeter(n).toFixed(2)+" px");e(k.x,k.y,m,p,l+", "+x)}};this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();this.onRedraw()}}}();wpd=wpd||{};wpd.args=function(){return{getValue:function(a){var b,c=window.location.search.substring(1).split("&");for(b=0;b<c.length;b++){var d=c[b].split("=");if(d[0]===a)return unescape(d[1])}return null}}}();wpd=wpd||{};
wpd.dataExport=function(){return{show:function(){},generateCSV:function(){wpd.popup.close("export-all-data-popup");var a=wpd.appData.getPlotData(),b=a.getDatasets();if(null==b||0===b.length)wpd.messagePopup.show(wpd.gettext("no-datasets-to-export-error"),wpd.gettext("no-datasets-to-export"));else{for(var c=0,d=[],e=[],f=[],g=0,h=0;h<b.length;h++){var k=a.getAxesForDataset(b[h]);if(null!=k){k=k.getAxesLabels();var l=k.length;g+=l;var n=b[h].getCount();n>c&&(c=n);d.push(b[h].name);for(n=0;n<l;n++)0!==
n&&d.push(""),e.push(k[n])}}for(h=0;h<c;h++){k=[];for(l=0;l<g;l++)k.push("");f.push(k)}for(h=g=0;h<b.length;h++)if(k=a.getAxesForDataset(b[h]),null!=k){l=k.getAxesLabels().length;n=b[h].getCount();for(var m=0;m<n;m++){var p=b[h].getPixel(m),q=m;var t=k;var r=p;p=t.pixelToData(r.x,r.y);if(t instanceof wpd.XYAxes)for(q=0;1>=q;q++)t.isDate(q)&&(r=t.getInitialDateFormat(q),p[q]=wpd.dateConverter.formatDateNumber(p[q],r));else t instanceof wpd.BarAxes&&(p=["",p[0]],p[0]=null==r.metadata?"Bar"+q:r.metadata[0]);
t=p;for(p=0;p<l;p++)f[m][g+p]=t[p]}g+=l}a=d.join(",")+"\n"+e.join(",")+"\n";for(b=0;b<c;b++)a+=f[b].join(",")+"\n";wpd.download.csv(a,"wpd_datasets.csv")}},exportToPlotly:function(){wpd.popup.close("export-all-data-popup");var a=wpd.appData.getPlotData().getDatasets(),b,c,d,e=wpd.plotDataProvider,f={data:[]};if(null==a||0===a.length)wpd.messagePopup.show(wpd.gettext("no-datasets-to-export-error"),wpd.gettext("no-datasets-to-export"));else{for(b=0;b<a.length;b++){e.setDataSource(a[b]);var g=e.getData();
f.data[b]={};for(c=0;2>c;c++){var h=0===c?"x":"y";f.data[b][h]=[];for(d=0;d<g.rawData.length;d++)f.data[b][h][d]=null!=g.fieldDateFormat[c]?wpd.dateConverter.formatDateNumber(g.rawData[d][c],"yyyy-mm-dd hh:ii:ss"):g.rawData[d][c]}}wpd.plotly.send(f)}}}}();wpd=wpd||{};
wpd.download=function(){function a(a,b){var c=document.createElement("a");c.href=URL.createObjectURL(new Blob([a]),{type:"text/plain"});c.download=b.replace(/[^a-zA-Z\d+\.\-_\s]/g,"_");c.style.display="none";document.body.appendChild(c);c.click();document.body.removeChild(c)}function b(a,b){var c=document.createElement("div");var d=document.createElement("form");var g=document.createElement("textarea");var h=document.createElement("input");h.type="hidden";d.setAttribute("method","post");d.setAttribute("action",
"download/text");g.setAttribute("name","data");g.setAttribute("id","data");h.setAttribute("name","filename");h.setAttribute("id","filename");h.value=b.replace(/[^a-zA-Z\d+\.\-_\s]/g,"_");d.appendChild(g);d.appendChild(h);c.appendChild(d);document.body.appendChild(c);c.style.display="none";g.innerHTML=a;d.submit();document.body.removeChild(c)}return{json:function(c,d){null==d&&(d="wpd_plot_data.json");wpd.browserInfo.downloadAttributeSupported?a(c,d):b(c,d)},csv:function(c,d){null==d&&(d="data.csv");
wpd.browserInfo.downloadAttributeSupported?a(c,d):b(c,d)}}}();wpd=wpd||{};
wpd.log=function(){wpd.browserInfo.isElectronBrowser()||fetch("log").then(function(a){return a.text()}).then(function(a){"true"==a&&(a={},a["screen-size"]=window.screen.width+"x"+window.screen.height,a["document-location"]=document.location.href,a["document-referrer"]=document.referrer,a.platform=window.navigator.platform,a.userAgent=window.navigator.userAgent,a.language=window.navigator.language,fetch("log",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},
body:JSON.stringify(a)}))})};wpd=wpd||{};wpd.plotly=function(){return{send:function(a){var b=document.createElement("div"),c=document.createElement("form"),d=document.createElement("textarea");c.setAttribute("method","post");c.setAttribute("action","https://plot.ly/external");c.setAttribute("target","_blank");d.setAttribute("name","data");d.setAttribute("id","data");c.appendChild(d);b.appendChild(c);document.body.appendChild(b);b.style.display="none";a=JSON.stringify(a);d.innerHTML=a;c.submit();document.body.removeChild(b)}}}();
wpd=wpd||{};
wpd.saveResume=function(){function a(){var a=wpd.appData.getPlotData();return JSON.stringify(a.serialize())}function b(a){var b=new FileReader;b.onload=function(){var a=JSON.parse(b.result);wpd.appData.getPlotData().deserialize(a);wpd.tree.refresh();wpd.graphicsWidget.resetData();wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.tree.refresh();wpd.messagePopup.show(wpd.gettext("import-json"),wpd.gettext("json-data-loaded"))};b.readAsText(a)}function c(a){wpd.busyNote.show();var b=
new tarball.TarReader;b.readFile(a).then(function(a){wpd.busyNote.close();var c=a.findIndex(function(a){return a.name.endsWith("/info.json")});if(0<=c){a=a[c].name.replace("/info.json","");c=b.getFileBlob(a+"/image.png","image/png");c.name="image.png";var e=JSON.parse(b.getTextFile(a+"/wpd.json"));wpd.imageManager.loadFromFile(c,!0).then(function(){wpd.appData.getPlotData().deserialize(e);wpd.tree.refresh();wpd.tree.refresh();wpd.messagePopup.show(wpd.gettext("import-json"),wpd.gettext("json-data-loaded"))})}},
function(a){console.log(a)})}return{save:function(){wpd.popup.show("export-json-window")},load:function(){wpd.popup.show("import-json-window")},downloadJSON:function(){var b=document.getElementById("project-name-input").value.replace(/[^a-zA-Z\d+\.\-_\s]/g,"_")+".json";wpd.download.json(a(),b);wpd.popup.close("export-json-window")},downloadProject:function(){var b=document.getElementById("project-name-input").value.replace(/[^a-zA-Z\d+\.\-_\s]/g,"_"),c=a(),f=wpd.graphicsWidget.getImagePNG(),g=JSON.stringify({version:[4,
0],json:"wpd.json",image:"image.png"}),h=new tarball.TarWriter;h.addFolder(b+"/");h.addTextFile(b+"/info.json",g);h.addTextFile(b+"/wpd.json",c);h.addFile(b+"/image.png",f);h.download(b+".tar");wpd.popup.close("export-json-window")},read:function(){var a=document.getElementById("import-json-file");wpd.popup.close("import-json-window");if(1===a.files.length){a=a.files[0];var e=a.type;if(""==e||null==e)a.name.endsWith(".json")?e="application/json":a.name.endsWith(".tar")&&(e="application/x-tar");"application/json"==
e?b(a):"application/x-tar"==e?c(a):wpd.messagePopup.show(wpd.gettext("invalid-project"),wpd.gettext("invalid-project-msg"))}}}}();wpd=wpd||{};
wpd.scriptInjector=function(){return{start:function(){wpd.popup.show("runScriptPopup")},cancel:function(){wpd.popup.close("runScriptPopup")},load:function(){var a=document.getElementById("runScriptFileInput");wpd.popup.close("runScriptPopup");if(1==a.files.length){var b=new FileReader;b.onload=function(){"undefined"!==typeof wpdscript&&(wpdscript=null);eval(b.result);"wpdscript"!==typeof wpdscript&&(window.wpdscript=wpdscript,wpdscript.run())};b.readAsText(a.files[0])}}}}();wpd=wpd||{};
wpd.appData=function(){function a(){null==b&&(b=new wpd.PlotData);return b}var b=null,c=null;return{isAligned:function(){return 0<a().getAxesCount()},getPlotData:a,getUndoManager:function(){null==c&&(c=new wpd.UndoManager);return c},reset:function(){c=b=null},plotLoaded:function(b){a().setTopColors(wpd.colorAnalyzer.getTopColors(b))}}}();wpd=wpd||{};wpd.autoExtraction=function(){return{start:function(){wpd.colorPicker.init();wpd.algoManager.updateAlgoList()}}}();
wpd.algoManager=function(){function a(){var a=wpd.tree.getActiveDataset();return wpd.appData.getPlotData().getAutoDetectionDataForDataset(a)}function b(){var b=document.getElementById("auto-extract-algo-name").value,e=a();e.algorithm="averagingWindow"===b?new wpd.AveragingWindowAlgo:"XStepWithInterpolation"===b?new wpd.XStepWithInterpolationAlgo:"XStep"===b?new wpd.AveragingWindowWithStepSizeAlgo:"blobDetector"===b?new wpd.BlobDetectorAlgo:"barExtraction"===b||"histogram"===b?new wpd.BarExtractionAlgo:
new wpd.AveragingWindowAlgo;c(e.algorithm)}function c(a){var b=document.getElementById("algo-parameter-container");a=a.getParamList(d);for(var c="<table>",e=0;e<a.length;e++)c+="<tr><td>"+a[e][0]+'</td><td><input type="text" size=3 id="algo-param-'+e+'" class="algo-params" value="'+a[e][2]+'"/></td><td>'+a[e][1]+"</td></tr>";b.innerHTML=c+"</table>"}var d,e;return{updateAlgoList:function(){e=wpd.tree.getActiveDataset();d=wpd.appData.getPlotData().getAxesForDataset(e);var f="",g=document.getElementById("auto-extract-algo-name");
d instanceof wpd.BarAxes||(f+='<option value="averagingWindow">'+wpd.gettext("averaging-window")+"</option>");d instanceof wpd.XYAxes&&(f+='<option value="XStepWithInterpolation">'+wpd.gettext("x-step-with-interpolation")+"</option>",f+='<option value="XStep">'+wpd.gettext("x-step")+"</option>");d instanceof wpd.BarAxes||(f+='<option value="blobDetector">'+wpd.gettext("blob-detector")+"</option>");d instanceof wpd.BarAxes&&(f+='<option value="barExtraction">'+wpd.gettext("bar-extraction")+"</option>");
d instanceof wpd.XYAxes&&(f+='<option value="histogram">'+wpd.gettext("histogram")+"</option>");g.innerHTML=f;f=a();null!=f.algorithm?(f.algorithm instanceof wpd.AveragingWindowAlgo?g.value="averagingWindow":f.algorithm instanceof wpd.XStepWithInterpolationAlgo?g.value="XStepWithInterpolation":f.algorithm instanceof wpd.AveragingWindowWithStepSizeAlgo?g.value="XStep":f.algorithm instanceof wpd.BlobDetectorAlgo?g.value="blobDetector":f.algorithm instanceof wpd.BarExtractionAlgo&&(g.value=d instanceof
wpd.XYAxes?"histogram":"barExtraction"),c(f.algorithm)):b()},applyAlgoSelection:b,run:function(){wpd.busyNote.show();for(var b=a(),c=b.algorithm,h=new wpd.DataPointsRepainter(d,e),k=document.getElementsByClassName("algo-params"),l=wpd.graphicsWidget.getAllContexts(),n=wpd.graphicsWidget.getImageSize(),m=0;m<k.length;m++){var p=parseInt(k[m].id.replace("algo-param-",""),10);c.setParam(p,parseFloat(k[m].value))}wpd.graphicsWidget.removeTool();k=l.oriImageCtx.getImageData(0,0,n.width,n.height);b.imageWidth=
n.width;b.imageHeight=n.height;b.generateBinaryData(k);wpd.graphicsWidget.setRepainter(h);c.run(b,e,d);wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount(e.getCount());wpd.busyNote.close();return!0}}}();
wpd.dataMask=function(){function a(){var a=wpd.graphicsWidget.getAllContexts(),c=wpd.graphicsWidget.getImageSize();a=a.oriDataCtx.getImageData(0,0,c.width,c.height);c=new Set;var d=wpd.tree.getActiveDataset();d=wpd.appData.getPlotData().getAutoDetectionDataForDataset(d);for(var e=0;e<a.data.length;e+=4)255===a.data[e]&&255===a.data[e+1]&&0===a.data[e+2]&&c.add(e/4);d.mask=c}return{grabMask:a,markBox:function(){var a=new wpd.BoxMaskTool;wpd.graphicsWidget.setTool(a)},markPen:function(){var a=new wpd.PenMaskTool;
wpd.graphicsWidget.setTool(a)},eraseMarks:function(){var a=new wpd.EraseMaskTool;wpd.graphicsWidget.setTool(a)},viewMask:function(){var a=new wpd.ViewMaskTool;wpd.graphicsWidget.setTool(a)},clearMask:function(){wpd.graphicsWidget.resetData();a()}}}();wpd=wpd||{};wpd.AxesCalibrator=function(a,b){this._calibration=a;this._isEditing=b};wpd.XYAxesCalibrator=function(a){wpd.AxesCalibrator.apply(this,arguments)};$jscomp.inherits(wpd.XYAxesCalibrator,wpd.AxesCalibrator);
wpd.XYAxesCalibrator.prototype.start=function(){wpd.popup.show("xyAxesInfo")};wpd.XYAxesCalibrator.prototype.reload=function(){var a=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(a)};wpd.XYAxesCalibrator.prototype.pickCorners=function(){wpd.popup.close("xyAxesInfo");var a=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(a)};
wpd.XYAxesCalibrator.prototype.getCornerValues=function(){wpd.popup.show("xyAlignment");if(this._isEditing){var a=wpd.tree.getActiveAxes(),b=a.calibration;4==b.getCount()&&(document.getElementById("xmin").value=b.getPoint(0).dx,document.getElementById("xmax").value=b.getPoint(1).dx,document.getElementById("ymin").value=b.getPoint(2).dy,document.getElementById("ymax").value=b.getPoint(3).dy,document.getElementById("xlog").checked=a.isLogX(),document.getElementById("ylog").checked=a.isLogY())}};
wpd.XYAxesCalibrator.prototype.align=function(){var a=document.getElementById("xmin").value,b=document.getElementById("xmax").value,c=document.getElementById("ymin").value,d=document.getElementById("ymax").value,e=document.getElementById("xlog").checked,f=document.getElementById("ylog").checked,g=this._isEditing?wpd.tree.getActiveAxes():new wpd.XYAxes;if(e&&(0==parseFloat(a)||0==parseFloat(b))||f&&(0==parseFloat(c)||0==parseFloat(d)))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show(wpd.gettext("calibration-invalid-log-inputs"),
wpd.gettext("calibration-enter-valid-log"),wpd.alignAxes.getCornerValues),!1;this._calibration.setDataAt(0,a,c);this._calibration.setDataAt(1,b,c);this._calibration.setDataAt(2,a,c);this._calibration.setDataAt(3,b,d);if(!g.calibrate(this._calibration,e,f))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show(wpd.gettext("calibration-invalid-inputs"),wpd.gettext("calibration-enter-valid"),wpd.alignAxes.getCornerValues),!1;this._isEditing||(g.name=wpd.alignAxes.makeAxesName(wpd.XYAxes),wpd.appData.getPlotData().addAxes(g));
wpd.popup.close("xyAlignment");return!0};wpd.BarAxesCalibrator=function(a){wpd.AxesCalibrator.apply(this,arguments)};$jscomp.inherits(wpd.BarAxesCalibrator,wpd.AxesCalibrator);wpd.BarAxesCalibrator.prototype.start=function(){wpd.popup.show("barAxesInfo")};wpd.BarAxesCalibrator.prototype.reload=function(){var a=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(a)};
wpd.BarAxesCalibrator.prototype.pickCorners=function(){wpd.popup.close("barAxesInfo");var a=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(a)};
wpd.BarAxesCalibrator.prototype.getCornerValues=function(){wpd.popup.show("barAlignment");if(this._isEditing){var a=wpd.tree.getActiveAxes(),b=a.calibration;2==b.getCount()&&(document.getElementById("bar-axes-p1").value=b.getPoint(0).dy,document.getElementById("bar-axes-p2").value=b.getPoint(1).dy,document.getElementById("bar-axes-log-scale").checked=a.isLog(),document.getElementById("bar-axes-rotated").checked=a.isRotated())}};
wpd.BarAxesCalibrator.prototype.align=function(){var a=document.getElementById("bar-axes-p1").value,b=document.getElementById("bar-axes-p2").value,c=document.getElementById("bar-axes-log-scale").checked,d=document.getElementById("bar-axes-rotated").checked,e=this._isEditing?wpd.tree.getActiveAxes():new wpd.BarAxes;this._calibration.setDataAt(0,0,a);this._calibration.setDataAt(1,0,b);if(!e.calibrate(this._calibration,c,d))return wpd.popup.close("barAlignment"),wpd.messagePopup.show(wpd.gettext("calibration-invalid-inputs"),
wpd.gettext("calibration-enter-valid"),wpd.alignAxes.getCornerValues),!1;this._isEditing||(e.name=wpd.alignAxes.makeAxesName(wpd.BarAxes),wpd.appData.getPlotData().addAxes(e));wpd.popup.close("barAlignment");return!0};wpd.PolarAxesCalibrator=function(a){wpd.AxesCalibrator.apply(this,arguments)};$jscomp.inherits(wpd.PolarAxesCalibrator,wpd.AxesCalibrator);wpd.PolarAxesCalibrator.prototype.start=function(){wpd.popup.show("polarAxesInfo")};
wpd.PolarAxesCalibrator.prototype.reload=function(){var a=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(a)};wpd.PolarAxesCalibrator.prototype.pickCorners=function(){wpd.popup.close("polarAxesInfo");var a=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(a)};
wpd.PolarAxesCalibrator.prototype.getCornerValues=function(){wpd.popup.show("polarAlignment");if(this._isEditing){var a=wpd.tree.getActiveAxes(),b=a.calibration;3==b.getCount()&&(document.getElementById("polar-r1").value=b.getPoint(1).dx,document.getElementById("polar-theta1").value=b.getPoint(1).dy,document.getElementById("polar-r2").value=b.getPoint(2).dx,document.getElementById("polar-theta2").value=b.getPoint(2).dy,document.getElementById("polar-degrees").checked=a.isThetaDegrees(),document.getElementById("polar-radians").checked=
!a.isThetaDegrees(),document.getElementById("polar-clockwise").checked=a.isThetaClockwise(),document.getElementById("polar-log-scale").checked=a.isRadialLog())}};
wpd.PolarAxesCalibrator.prototype.align=function(){var a=parseFloat(document.getElementById("polar-r1").value),b=parseFloat(document.getElementById("polar-theta1").value),c=parseFloat(document.getElementById("polar-r2").value),d=parseFloat(document.getElementById("polar-theta2").value),e=document.getElementById("polar-degrees").checked,f=document.getElementById("polar-clockwise").checked,g=document.getElementById("polar-log-scale").checked,h=this._isEditing?wpd.tree.getActiveAxes():new wpd.PolarAxes;
this._calibration.setDataAt(1,a,b);this._calibration.setDataAt(2,c,d);h.calibrate(this._calibration,e,f,g);this._isEditing||(h.name=wpd.alignAxes.makeAxesName(wpd.PolarAxes),wpd.appData.getPlotData().addAxes(h));wpd.popup.close("polarAlignment");return!0};wpd.TernaryAxesCalibrator=function(a){wpd.AxesCalibrator.apply(this,arguments)};$jscomp.inherits(wpd.TernaryAxesCalibrator,wpd.AxesCalibrator);wpd.TernaryAxesCalibrator.prototype.start=function(){wpd.popup.show("ternaryAxesInfo")};
wpd.TernaryAxesCalibrator.prototype.reload=function(){var a=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(a)};wpd.TernaryAxesCalibrator.prototype.pickCorners=function(){wpd.popup.close("ternaryAxesInfo");var a=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(a)};
wpd.TernaryAxesCalibrator.prototype.getCornerValues=function(){wpd.popup.show("ternaryAlignment");if(this._isEditing){var a=wpd.tree.getActiveAxes();3==prevCal.getCount()&&(document.getElementById("range0to1").checked=!a.isRange100(),document.getElementById("range0to100").checked=a.isRange100(),document.getElementById("ternarynormal").checked=a.isNormalOrientation())}};
wpd.TernaryAxesCalibrator.prototype.align=function(){var a=document.getElementById("range0to100").checked,b=document.getElementById("ternarynormal").checked,c=this._isEditing?wpd.tree.getActiveAxes():new wpd.TernaryAxes;c.calibrate(this._calibration,a,b);this._isEditing||(c.name=wpd.alignAxes.makeAxesName(wpd.TernaryAxes),wpd.appData.getPlotData().addAxes(c));wpd.popup.close("ternaryAlignment");return!0};wpd.MapAxesCalibrator=function(a){wpd.AxesCalibrator.apply(this,arguments)};
$jscomp.inherits(wpd.MapAxesCalibrator,wpd.AxesCalibrator);wpd.MapAxesCalibrator.prototype.start=function(){wpd.popup.show("mapAxesInfo")};wpd.MapAxesCalibrator.prototype.reload=function(){var a=new wpd.AxesCornersTool(this._calibration,!0);wpd.graphicsWidget.setTool(a)};wpd.MapAxesCalibrator.prototype.pickCorners=function(){wpd.popup.close("mapAxesInfo");var a=new wpd.AxesCornersTool(this._calibration,!1);wpd.graphicsWidget.setTool(a)};
wpd.MapAxesCalibrator.prototype.getCornerValues=function(){wpd.popup.show("mapAlignment");if(this._isEditing){var a=wpd.tree.getActiveAxes();2==prevCal.getCount()&&(document.getElementById("scaleLength").checked=a.getScaleLength(),document.getElementById("scaleUnits").checked=a.getUnits())}};
wpd.MapAxesCalibrator.prototype.align=function(){var a=parseFloat(document.getElementById("scaleLength").value),b=document.getElementById("scaleUnits").value,c=this._isEditing?wpd.tree.getActiveAxes():new wpd.MapAxes;c.calibrate(this._calibration,a,b);this._isEditing||(c.name=wpd.alignAxes.makeAxesName(wpd.MapAxes),wpd.appData.getPlotData().addAxes(c));wpd.popup.close("mapAlignment");return!0};
wpd.alignAxes=function(){function a(){var a=wpd.tree.getActiveAxes();document.getElementById("rename-axes-name-input").value=a.name;wpd.popup.show("rename-axes-popup")}function b(){var b=document.getElementById("rename-axes-name-input");wpd.popup.close("rename-axes-popup");b=b.value.trim();0<=wpd.appData.getPlotData().getAxesNames().indexOf(b)||0===b.length?wpd.messagePopup.show(wpd.gettext("rename-axes-error"),wpd.gettext("axes-exists-error"),a):(wpd.tree.getActiveAxes().name=b,wpd.tree.refresh(),
wpd.tree.selectPath("/"+wpd.gettext("axes")+"/"+b,!0))}var c=null,d=null;return{start:function(){var a=document.getElementById("r_xy"),b=document.getElementById("r_polar"),g=document.getElementById("r_ternary"),h=document.getElementById("r_map"),k=document.getElementById("r_image"),l=document.getElementById("r_bar");wpd.popup.close("axesList");!0===a.checked?(c=new wpd.Calibration(2),c.labels=["X1","X2","Y1","Y2"],c.labelPositions=["N","N","E","E"],c.maxPointCount=4,d=new wpd.XYAxesCalibrator(c)):
!0===l.checked?(c=new wpd.Calibration(2),c.labels=["P1","P2"],c.labelPositions=["S","S"],c.maxPointCount=2,d=new wpd.BarAxesCalibrator(c)):!0===b.checked?(c=new wpd.Calibration(2),c.labels=["Origin","P1","P2"],c.labelPositions=["E","S","S"],c.maxPointCount=3,d=new wpd.PolarAxesCalibrator(c)):!0===g.checked?(c=new wpd.Calibration(2),c.labels=["A","B","C"],c.labelPositions=["S","S","E"],c.maxPointCount=3,d=new wpd.TernaryAxesCalibrator(c)):!0===h.checked?(c=new wpd.Calibration(2),c.labels=["P1","P2"],
c.labelPositions=["S","S"],c.maxPointCount=2,d=new wpd.MapAxesCalibrator(c)):!0===k.checked&&(d=c=null,a=new wpd.ImageAxes,a.name=wpd.alignAxes.makeAxesName(wpd.ImageAxes),a.calibrate(),wpd.appData.getPlotData().addAxes(a),wpd.tree.refresh(),a=wpd.appData.getPlotData().getDatasetNames(),0<a.length&&(a=a[0],wpd.tree.selectPath("/"+wpd.gettext("datasets")+"/"+a,!0)),wpd.acquireData.load());null!=d&&(d.start(),wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter(c)))},calibrationCompleted:function(){wpd.sidebar.show("axes-calibration-sidebar")},
zoomCalPoint:function(a){a=c.getPoint(a);wpd.graphicsWidget.updateZoomToImagePosn(a.px,a.py)},getCornerValues:function(){d.getCornerValues()},pickCorners:function(){d.pickCorners()},align:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();if(d.align()){wpd.tree.refresh();var a=wpd.appData.getPlotData().getDatasetNames();0<a.length&&(a=a[0],wpd.tree.selectPath("/"+wpd.gettext("datasets")+"/"+a))}},editAlignment:function(){wpd.appData.isAligned()&&
null!=d?wpd.popup.show("edit-or-reset-calibration-popup"):wpd.popup.show("axesList")},reloadCalibrationForEditing:function(){wpd.popup.close("edit-or-reset-calibration-popup");d=null;var a=wpd.tree.getActiveAxes();c=a.calibration;a instanceof wpd.XYAxes?d=new wpd.XYAxesCalibrator(c,!0):a instanceof wpd.BarAxes?d=new wpd.BarAxesCalibrator(c,!0):a instanceof wpd.PolarAxes?d=new wpd.PolarAxesCalibrator(c,!0):a instanceof wpd.TernaryAxes?d=new wpd.TernaryAxesCalibrator(c,!0):a instanceof wpd.MapAxes&&
(d=new wpd.MapAxesCalibrator(c,!0));null!=d&&(d.reload(),wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter(c)),wpd.graphicsWidget.forceHandlerRepaint(),wpd.sidebar.show("axes-calibration-sidebar"))},addCalibration:function(){wpd.popup.show("axesList")},deleteCalibration:function(){wpd.okCancelPopup.show(wpd.gettext("delete-axes"),wpd.gettext("delete-axes-text"),function(){var a=wpd.appData.getPlotData(),b=wpd.tree.getActiveAxes();a.deleteAxes(b);wpd.tree.refresh();wpd.tree.selectPath("/"+
wpd.gettext("axes"))})},showRenameAxes:a,makeAxesName:function(a){var b="",c=wpd.appData.getPlotData().getAxesNames();a===wpd.XYAxes?b=wpd.gettext("axes-name-xy"):a===wpd.PolarAxes?b=wpd.gettext("axes-name-polar"):a===wpd.MapAxes?b=wpd.gettext("axes-name-map"):a===wpd.TernaryAxes?b=wpd.gettext("axes-name-ternary"):a===wpd.BarAxes?b=wpd.gettext("axes-name-bar"):a===wpd.ImageAxes&&(b=wpd.gettext("axes-name-image"));a=2;for(var e=b;0<=c.indexOf(e);)e=b+" "+a,a++;return e},renameAxes:b,renameKeypress:function(a){"Enter"===
a.key&&b()}}}();wpd=wpd||{};wpd.browserInfo=function(){return{checkBrowser:function(){window.FileReader&&"object"===typeof WebAssembly||alert("WARNING!\nYour web browser may not be fully supported. Please use a recent version of Google Chrome, Firefox or Safari browser with HTML5 and WebAssembly support.")},downloadAttributeSupported:"download"in document.createElement("a"),isElectronBrowser:function(){return"undefined"===typeof process?!1:!0}}}();wpd=wpd||{};
wpd.colorSelectionWidget=function(){function a(){document.getElementById("color-selection-selected-color-box").style.backgroundColor="rgb("+b[0]+","+b[1]+","+b[2]+")";document.getElementById("color-selection-red").value=b[0];document.getElementById("color-selection-green").value=b[1];document.getElementById("color-selection-blue").value=b[2];for(var a=document.getElementById("color-selection-options"),c=wpd.appData.getPlotData().getTopColors(),e=10<c.length?10:c.length,d="",l=0;l<e;l++){var n="rgb("+
c[l].r+","+c[l].g+","+c[l].b+");",m=c[l].percentage.toFixed(3)+"%";d+='<div class="colorOptionBox" style="background-color: '+n+'" title="'+m+'" onclick="wpd.colorSelectionWidget.selectTopColor('+l+');"></div>'}a.innerHTML=d;wpd.popup.show("color-selection-widget")}var b,c,d,e;return{setParams:function(a){b=a.color;c=a.triggerElementId;d=a.title;e=a.setColorDelegate;document.getElementById("color-selection-title").innerHTML=d},startPicker:a,pickColor:function(){wpd.popup.close("color-selection-widget");
var c=new wpd.ColorPickerTool;c.onComplete=function(c){b=c;e(c);wpd.graphicsWidget.removeTool();a()};wpd.graphicsWidget.setTool(c)},setColor:function(){var a=[];a[0]=parseInt(document.getElementById("color-selection-red").value,10);a[1]=parseInt(document.getElementById("color-selection-green").value,10);a[2]=parseInt(document.getElementById("color-selection-blue").value,10);b=a;e(a);wpd.popup.close("color-selection-widget");a=document.getElementById(c);a.style.backgroundColor="rgb("+b[0]+","+b[1]+
","+b[2]+")";a.style.color=200>b[0]+b[1]+b[2]?"rgb(255,255,255)":"rgb(0,0,0)"},selectTopColor:function(c){var d=[],f=wpd.appData.getPlotData().getTopColors();d[0]=f[c].r;d[1]=f[c].g;d[2]=f[c].b;b=d;e(d);a()},paintFilteredColor:function(a,b){var c=wpd.graphicsWidget.getAllContexts(),e=wpd.graphicsWidget.getImageSize();e=c.oriDataCtx.getImageData(0,0,e.width,e.height);if(null!=b&&0!==b.size){b=$jscomp.makeIterator(b);for(var d=b.next();!d.done;d=b.next())d=d.value,a.has(d)?(e.data[4*d]=255,e.data[4*
d+1]=255,e.data[4*d+2]=0,e.data[4*d+3]=255):(e.data[4*d]=0,e.data[4*d+1]=0,e.data[4*d+2]=0,e.data[4*d+3]=150);c.oriDataCtx.putImageData(e,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}}}}();
wpd.colorPicker=function(){function a(){var a=wpd.tree.getActiveDataset();return wpd.appData.getPlotData().getAutoDetectionDataForDataset(a)}function b(){var b=a();return{color:b.fgColor,triggerElementId:"color-button",title:wpd.gettext("specify-foreground-color"),setColorDelegate:function(a){b.fgColor=a}}}function c(){var b=a();return{color:b.bgColor,triggerElementId:"color-button",title:wpd.gettext("specify-background-color"),setColorDelegate:function(a){b.bgColor=a}}}function d(){var b=document.getElementById("color-button"),
c=document.getElementById("color-distance-value"),d=a(),h=document.getElementById("color-detection-mode-select");var k="fg"===d.colorDetectionMode?d.fgColor:d.bgColor;var l=d.colorDistance;b.style.backgroundColor="rgb("+k[0]+","+k[1]+","+k[2]+")";c.value=l;h.value=d.colorDetectionMode}return{startPicker:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();"fg"===a().colorDetectionMode?wpd.colorSelectionWidget.setParams(b()):wpd.colorSelectionWidget.setParams(c());
wpd.colorSelectionWidget.startPicker()},changeDetectionMode:function(){var b=document.getElementById("color-detection-mode-select");a().colorDetectionMode=b.value;d()},changeColorDistance:function(){var b=parseFloat(document.getElementById("color-distance-value").value);a().colorDistance=b},init:d,testColorDetection:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.ColorFilterRepainter);var b=wpd.graphicsWidget.getAllContexts(),c=a(),
d=wpd.graphicsWidget.getImageSize();b=b.oriImageCtx.getImageData(0,0,d.width,d.height);c.generateBinaryData(b);wpd.colorSelectionWidget.paintFilteredColor(c.binaryData,c.mask)}}}();wpd=wpd||{};
wpd.dataSeriesManagement=function(){function a(a){return 0<=wpd.appData.getPlotData().getDatasetNames().indexOf(a)?!0:!1}function b(){var a=wpd.tree.getActiveDataset();document.getElementById("rename-dataset-name-input").value=a.name;wpd.popup.show("rename-dataset-popup")}function c(){var c=document.getElementById("rename-dataset-name-input");wpd.popup.close("rename-dataset-popup");if(a(c.value.trim()))wpd.messagePopup.show(wpd.gettext("rename-dataset-error"),wpd.gettext("dataset-exists-error"),b);
else{var e=wpd.tree.getActiveDataset();e.name=c.value.trim();wpd.tree.refresh();wpd.tree.selectPath("/"+wpd.gettext("datasets")+"/"+e.name,!0)}}return{showAddDataset:function(){for(var b=document.getElementById("add-single-dataset-name-input"),c=wpd.appData.getPlotData().getDatasetCount(),f=wpd.gettext("dataset")+" "+c;a(f);)c++,f=wpd.gettext("dataset")+" "+c;b.value=f;wpd.popup.show("add-dataset-popup")},showRenameDataset:b,renameDataset:c,renameKeypress:function(a){"Enter"===a.key&&c()},addSingleDataset:function(){var b=
document.getElementById("add-single-dataset-name-input");wpd.popup.close("add-dataset-popup");if(a(b.value.trim()))wpd.messagePopup.show(wpd.gettext("add-dataset-error"),wpd.gettext("dataset-exists-error"),function(){wpd.popup.show("add-dataset-popup")});else{var c=wpd.appData.getPlotData(),f=new wpd.Dataset;f.name=b.value.trim();c.addDataset(f);wpd.tree.refreshPreservingSelection()}},addMultipleDatasets:function(){var b=document.getElementById("add-multiple-datasets-count-input");b=parseInt(b.value,
0);wpd.popup.close("add-dataset-popup");if(0<b){for(var c=wpd.appData.getPlotData(),f=wpd.appData.getPlotData().getDatasetCount(),g=wpd.gettext("dataset")+" ",h=0;h<b;){var k=g+f;if(!a(k)){var l=new wpd.Dataset;l.name=k;c.addDataset(l);h++}f++}wpd.tree.refreshPreservingSelection()}else wpd.messagePopup(wpd.gettext("add-dataset-error"),wpd.gettext("add-dataset-count-error"),function(){wpd.popup.show("add-dataset-popup")})},deleteDataset:function(){wpd.okCancelPopup.show(wpd.gettext("delete-dataset"),
wpd.gettext("delete-dataset-text"),function(){var a=wpd.appData.getPlotData(),b=wpd.tree.getActiveDataset();a.deleteDataset(b);wpd.tree.refresh();wpd.tree.selectPath("/"+wpd.gettext("datasets"))})},changeAxes:function(a){var b=wpd.appData.getPlotData(),c=b.getAxesColl(),d=wpd.tree.getActiveDataset();a=parseInt(a,10);-1===a?b.setAxesForDataset(d,null):0<=a&&a<c.length&&b.setAxesForDataset(d,c[a]);wpd.tree.refreshPreservingSelection(!0)}}}();wpd=wpd||{};
wpd.gridDetection=function(){function a(a,b,c){for(var e=wpd.appData.getPlotData().getGridDetectionData().backupImageData,d=0;d<e.data.length;d++)a.data[d]=e.data[d];return{imageData:a,width:b,height:c,keepZoom:!0}}function b(){wpd.graphicsWidget.removeTool();wpd.appData.getPlotData().getGridDetectionData().gridData=null;wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();null!=wpd.appData.getPlotData().getGridDetectionData().backupImageData&&wpd.graphicsWidget.runImageOp(a)}function c(a,
b,c){var e=wpd.appData.getPlotData().getGridDetectionData().gridData,d=wpd.appData.getPlotData().getTopColors()[0];null==d&&(d={r:255,g:0,b:0});if(null!=e)for(var f=0;f<c;f++)for(var g=0;g<b;g++){var m=4*(f*b+g);e.has(m/4)&&(a.data[m]=d.r,a.data[m+1]=d.g,a.data[m+2]=d.b,a.data[m+3]=255)}return{imageData:a,width:b,height:c}}function d(){var a=parseFloat(document.getElementById("grid-color-distance").value);wpd.appData.getPlotData().getGridDetectionData().colorDistance=a}return{start:function(){wpd.graphicsWidget.removeTool();
wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();wpd.sidebar.show("grid-detection-sidebar");var a=document.getElementById("grid-color-picker-button"),b=document.getElementById("grid-background-mode"),c=wpd.appData.getPlotData().getGridDetectionData(),d=c.lineColor;c=c.gridBackgroundMode;null!=d&&(a.style.backgroundColor="rgb("+d[0]+","+d[1]+","+d[2]+")",a.style.color=200>d[0]+d[1]+d[2]?"rgb(255,255,255)":"rgb(0,0,0)");b.checked=c},markBox:function(){var a=new wpd.GridBoxTool;wpd.graphicsWidget.setTool(a)},
clearMask:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.appData.getPlotData().getGridDetectionData().gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:new Set};wpd.graphicsWidget.resetData()},viewMask:function(){var a=new wpd.GridViewMaskTool;wpd.graphicsWidget.setTool(a)},grabMask:function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.graphicsWidget.getImageSize();a=a.oriDataCtx.getImageData(0,0,b.width,b.height);for(var c=new Set,d=0,k=wpd.appData.getPlotData().getGridDetectionData(),
l=0;l<a.data.length;l+=4)if(255===a.data[l]&&255===a.data[l+1]&&0===a.data[l+2]){c.add(l/4);d++;var n=parseInt(l/4%b.width,10),m=parseInt(l/4/b.width,10);1===d?(k.gridMask.xmin=n,k.gridMask.xmax=n,k.gridMask.ymin=m,k.gridMask.ymax=m):(n<k.gridMask.xmin&&(k.gridMask.xmin=n),n>k.gridMask.xmax&&(k.gridMask.xmax=n),m<k.gridMask.ymin&&(k.gridMask.ymin=m),m>k.gridMask.ymax&&(k.gridMask.ymax=m))}k.gridMask.pixels=c},startColorPicker:function(){wpd.colorSelectionWidget.setParams({color:wpd.appData.getPlotData().getGridDetectionData().lineColor,
triggerElementId:"grid-color-picker-button",title:"Specify Grid Line Color",setColorDelegate:function(a){wpd.appData.getPlotData().getGridDetectionData().lineColor=a}});wpd.colorSelectionWidget.startPicker()},changeColorDistance:d,changeBackgroundMode:function(){var a=document.getElementById("grid-background-mode").checked;wpd.appData.getPlotData().getGridDetectionData().gridBackgroundMode=a},testColor:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.GridColorFilterRepainter);
var a=wpd.appData.getPlotData().getGridDetectionData();d();var b=wpd.graphicsWidget.getAllContexts(),c=wpd.graphicsWidget.getImageSize();b=b.oriImageCtx.getImageData(0,0,c.width,c.height);a.generateBinaryData(b);wpd.colorSelectionWidget.paintFilteredColor(a.binaryData,a.gridMask.pixels)},run:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();b();var a=wpd.appData.getPlotData().getGridDetectionData(),d=wpd.graphicsWidget.getAllContexts(),
g=wpd.graphicsWidget.getImageSize(),h=document.getElementById("grid-horiz-perc"),k=document.getElementById("grid-vert-perc"),l=document.getElementById("grid-horiz-enable").checked,n=document.getElementById("grid-vert-enable").checked;document.getElementById("grid-background-mode");wpd.appData.getPlotData();null==a.backupImageData&&(a.backupImageData=d.oriImageCtx.getImageData(0,0,g.width,g.height));d=d.oriImageCtx.getImageData(0,0,g.width,g.height);a.generateBinaryData(d);wpd.gridDetectionCore.setHorizontalParameters(l,
h.value);wpd.gridDetectionCore.setVerticalParameters(n,k.value);a.gridData=wpd.gridDetectionCore.run(a);wpd.graphicsWidget.runImageOp(c);wpd.appData.getPlotData().getGridDetectionData().gridData=null},reset:b}}();wpd=wpd||{};wpd.gettext=function(a){return(a=document.getElementById("i18n-string-"+a))?a.innerHTML:"i18n string"};wpd=wpd||{};
wpd.imageEditing={showImageInfo:function(){var a=document.getElementById("image-info-dimensions"),b=wpd.imageManager.getImageInfo();a.innerHTML="("+b.width+"x"+b.height+")";wpd.popup.show("image-info-popup")},startImageCrop:function(){wpd.graphicsWidget.setTool(new wpd.CropTool)},startPerspective:function(){wpd.popup.show("perspective-info")},startPerspectiveConfirmed:function(){},undo:function(){wpd.appData.getUndoManager().undo()},redo:function(){wpd.appData.getUndoManager().redo()}};
wpd.ReversibleAction=function(){};wpd.ReversibleAction.prototype.execute=function(){};wpd.ReversibleAction.prototype.undo=function(){};wpd.CropImageAction=function(a,b,c,d){wpd.ReversibleAction.call(this);this._x0=a;this._y0=b;this._x1=c;this._y1=d;this._originalImage=null};$jscomp.inherits(wpd.CropImageAction,wpd.ReversibleAction);
wpd.CropImageAction.prototype.execute=function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.graphicsWidget.getImageSize();this._originalImage=a.oriImageCtx.getImageData(0,0,b.width,b.height);var c=a.oriImageCtx.getImageData(this._x0,this._y0,this._x1,this._y1),d=this._x1-this._x0,e=this._y1-this._y0;wpd.graphicsWidget.runImageOp(function(a,b,h){return{imageData:c,width:d,height:e,keepZoom:!0}})};
wpd.CropImageAction.prototype.undo=function(){var a=this._originalImage;wpd.graphicsWidget.runImageOp(function(b,c,d){return{imageData:a,width:a.width,height:a.height}})};wpd=wpd||{};
wpd.imageManager=function(){function a(a,c){return new Promise(function(d,e){if(a.type.match("image.*")){wpd.busyNote.show();var f=new FileReader;f.onload=function(){b(f.result,c).then(d)};f.readAsDataURL(a)}else if("application/pdf"==a.type){wpd.busyNote.show();var g=new FileReader;g.onload=function(){PDFJS.getDocument(g.result).then(function(a){a.getPage(1).then(function(a){var f=a.getViewport(3),g=document.createElement("canvas"),h=g.getContext("2d");g.width=f.width;g.height=f.height;a.render({canvasContext:h,
viewport:f}).promise.then(function(){var a=g.toDataURL();b(a,c).then(d)},function(a){console.log(a);wpd.busyNote.close();e(a)})})})};g.readAsDataURL(a)}else console.log(a.type),wpd.messagePopup.show(wpd.gettext("invalid-file"),wpd.gettext("invalid-file-text"))})}function b(a,b){return new Promise(function(e,f){var g=new Image;g.onload=function(){wpd.appData.reset();wpd.sidebar.clear();var a=wpd.graphicsWidget.loadImage(g);wpd.appData.plotLoaded(a);wpd.busyNote.close();wpd.tree.refresh();c?wpd.sidebar.show("start-sidebar"):
b||wpd.popup.show("axesList");c=!1;d={width:a.width,height:a.height};e()};g.src=a})}var c=!0,d={width:0,height:0};return{saveImage:function(){wpd.graphicsWidget.saveImage()},loadFromURL:b,loadFromFile:a,load:function(){var b=document.getElementById("fileLoadBox");1==b.files.length&&a(b.files[0]);wpd.popup.close("loadNewImage")},getImageInfo:function(){return d}}}();wpd=wpd||{};
wpd.acquireData=function(){function a(){var a=new wpd.ManualSelectionTool(h,g);wpd.graphicsWidget.setTool(a)}function b(){var a=new wpd.DeleteDataPointTool(h,g);wpd.graphicsWidget.setTool(a)}function c(){g.clearAll();wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.dataPointCounter.setCount(g.getCount());wpd.graphicsWidget.removeRepainter()}function d(){wpd.sidebar.show("acquireDataSidebar");document.getElementById("edit-data-labels").style.display=h instanceof wpd.BarAxes?"inline-block":
"none";wpd.dataPointCounter.setCount(g.getCount())}function e(){wpd.graphicsWidget.setTool(new wpd.AdjustDataPointTool(h,g))}function f(){wpd.graphicsWidget.setTool(new wpd.EditLabelsTool(h,g))}var g,h;return{load:function(){g=wpd.tree.getActiveDataset();h=wpd.appData.getPlotData().getAxesForDataset(wpd.tree.getActiveDataset());null==h?wpd.messagePopup.show(wpd.gettext("dataset-no-calibration"),wpd.gettext("calibrate-dataset")):(wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.resetData(),d(),wpd.autoExtraction.start(),
wpd.dataPointCounter.setCount(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter(h,g)),a(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.dataPointCounter.setCount(g.getCount()))},manualSelection:a,adjustPoints:e,deletePoint:b,clearAll:function(){0>=g.getCount()||wpd.okCancelPopup.show(wpd.gettext("clear-data-points"),wpd.gettext("clear-data-points-text"),c,function(){})},undo:function(){g.removeLastPixel();wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();
wpd.dataPointCounter.setCount(g.getCount())},showSidebar:d,switchToolOnKeyPress:function(c){switch(c){case "d":b();break;case "a":a();break;case "s":e();break;case "e":f()}},isToolSwitchKey:function(a){return wpd.keyCodes.isAlphabet(a,"a")||wpd.keyCodes.isAlphabet(a,"s")||wpd.keyCodes.isAlphabet(a,"d")||wpd.keyCodes.isAlphabet(a,"e")?!0:!1},editLabels:f}}();
wpd.dataPointLabelEditor=function(){function a(){var a=document.getElementById("data-point-label-field").value;null!=a&&0<a.length&&(c.setMetadataAt(d,[a]),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint());wpd.popup.close("data-point-label-editor");wpd.graphicsWidget.setTool(e)}function b(){wpd.popup.close("data-point-label-editor");wpd.graphicsWidget.setTool(e)}var c,d,e;return{show:function(a,b,h){var f=a.getPixel(b).metadata[0];c=a;d=b;e=h;wpd.graphicsWidget.removeTool();
wpd.popup.show("data-point-label-editor");a=document.getElementById("data-point-label-field");a.value=f;a.focus()},ok:a,cancel:b,keydown:function(c){wpd.keyCodes.isEnter(c.keyCode)?a():wpd.keyCodes.isEsc(c.keyCode)&&b();c.stopPropagation()}}}();wpd=wpd||{};
wpd.measurementModes={distance:{name:"distance",connectivity:2,addButtonId:"add-pair-button",deleteButtonId:"delete-pair-button",sidebarId:"measure-distances-sidebar",init:function(){var a=wpd.appData.getPlotData();0==a.getMeasurementsByType(wpd.DistanceMeasurement).length&&a.addMeasurement(new wpd.DistanceMeasurement)},clear:function(){wpd.appData.getPlotData().getMeasurementsByType(wpd.DistanceMeasurement).forEach(function(a){a.clearAll()})},getData:function(){return wpd.appData.getPlotData().getMeasurementsByType(wpd.DistanceMeasurement)[0]},
getAxes:function(){var a=wpd.appData.getPlotData(),b=a.getMeasurementsByType(wpd.DistanceMeasurement);return a.getAxesForMeasurement(b[0])},changeAxes:function(a){var b=wpd.appData.getPlotData(),c=b.getMeasurementsByType(wpd.DistanceMeasurement)[0],d=b.getAxesColl();-1==a?b.setAxesForMeasurement(c,null):b.setAxesForMeasurement(c,d[a]);wpd.tree.refreshPreservingSelection(!0)}},angle:{name:"angle",connectivity:3,addButtonId:"add-angle-button",deleteButtonId:"delete-angle-button",sidebarId:"measure-angles-sidebar",
init:function(){var a=wpd.appData.getPlotData();0==a.getMeasurementsByType(wpd.AngleMeasurement).length&&a.addMeasurement(new wpd.AngleMeasurement)},clear:function(){wpd.appData.getPlotData().getMeasurementsByType(wpd.AngleMeasurement).forEach(function(a){a.clearAll()})},getData:function(){return wpd.appData.getPlotData().getMeasurementsByType(wpd.AngleMeasurement)[0]}},area:{name:"area",connectivity:-1,addButtonId:"add-polygon-button",deleteButtonId:"delete-polygon-button",sidebarId:"measure-area-sidebar",
init:function(){var a=wpd.appData.getPlotData();0==a.getMeasurementsByType(wpd.AreaMeasurement).length&&a.addMeasurement(new wpd.AreaMeasurement)},clear:function(){wpd.appData.getPlotData().getMeasurementsByType(wpd.AreaMeasurement).forEach(function(a){a.clearAll()})},getData:function(){return wpd.appData.getPlotData().getMeasurementsByType(wpd.AreaMeasurement)[0]},getAxes:function(){var a=wpd.appData.getPlotData(),b=a.getMeasurementsByType(wpd.AreaMeasurement);return a.getAxesForMeasurement(b[0])},
changeAxes:function(a){var b=wpd.appData.getPlotData(),c=b.getMeasurementsByType(wpd.AreaMeasurement)[0],d=b.getAxesColl();-1==a?b.setAxesForMeasurement(c,null):b.setAxesForMeasurement(c,d[a]);wpd.tree.refreshPreservingSelection(!0)}}};
wpd.measurement=function(){var a;return{start:function(b){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();b.init();wpd.sidebar.show(b.sidebarId);wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(b));wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(b));wpd.graphicsWidget.forceHandlerRepaint();a=b},addItem:function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(a));wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(a))},deleteItem:function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(a));
wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(a))},clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();a.clear()},changeAxes:function(b){a.changeAxes(parseInt(b,10))}}}();wpd=wpd||{};wpd.UndoManager=function(){this._actions=[];this._actionIndex=0};wpd.UndoManager.prototype.canUndo=function(){return 0<this._actionIndex&&this._actions.length>=this._actionIndex};
wpd.UndoManager.prototype.undo=function(){this.canUndo()&&(this._actionIndex--,this._actions[this._actionIndex].undo(),this.updateUI())};wpd.UndoManager.prototype.canRedo=function(){return this._actions.length>this._actionIndex};wpd.UndoManager.prototype.redo=function(){this.canRedo()&&(this._actions[this._actionIndex].execute(),this._actionIndex++,this.updateUI())};
wpd.UndoManager.prototype.insertAction=function(a){a instanceof wpd.ReversibleAction?(this.canRedo()&&(this._actions.length=this._actionIndex),this._actions.push(a),this._actionIndex++,this.updateUI()):console.error("action must be a wpd.ReversibleAction!")};wpd.UndoManager.prototype.clear=function(){this._actions=[];this._actionIndex=0;this.updateUI()};
wpd.UndoManager.prototype.updateUI=function(){var a=document.getElementById("image-editing-undo"),b=document.getElementById("image-editing-redo");this.canUndo()?a.disabled=!1:a.disabled=!0;this.canRedo()?b.disabled=!1:b.disabled=!0};
